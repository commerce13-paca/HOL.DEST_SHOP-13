<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta Admaven -->
    <meta name='admaven-placement' content="Bqja5pjUF">
    
    <!-- SEO Optimis√© -->
    <title>H.D.S SHOP - Organisation √âv√©nements & Boutique Premium | Marseille</title>
    <meta name="description" content="H.D.S SHOP - Organisation d'√©v√©nements √† Marseille. Anniversaires enfants/ados/adultes, √©v√©nements entreprises, mariages, soir√©es priv√©es. Livraison 24h/24.">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="H.D.S SHOP - Organisation √âv√©nements & Boutique Premium">
    <meta property="og:description" content="Organisation compl√®te d'√©v√©nements √† Marseille. Anniversaires, soir√©es, √©v√©nements pros. Service premium avec livraison 24h/24.">
    <meta property="og:image" content="https://mcusercontent.com/40a9f1a77d46874eba2309d88/images/89a59702-cad3-dfb7-580d-22fb843f8d3f.jpeg">
    <meta property="og:url" content="https://web-site13015.github.io/H_D_S-SHOP/">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="fr_FR">
    
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_CLIENT_ID&currency=EUR"></script>
    
    <!-- Liens ressources externes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee+Spice&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://kit.fontawesome.com/90a4d1138d.js" crossorigin="anonymous"></script>
    
    <!-- Leaflet pour la carte -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéâ</text></svg>">
    
    <style>
        /* === RESET & BASE STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-yellow: #FFD700;
            --primary-gold: #FFC107;
            --primary-black: #000000;
            --primary-white: #FFFFFF;
            --dark-bg: #0A0A0A;
            --card-bg: #111111;
            --gray-100: #F5F5F5;
            --gray-200: #EEEEEE;
            --gray-300: #E0E0E0;
            --gray-400: #BDBDBD;
            --gray-500: #9E9E9E;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
            
            --accent-red: #FF5252;
            --accent-green: #4CAF50;
            --accent-blue: #2196F3;
            --accent-purple: #9C27B0;
            --accent-pink: #E91E63;
            --accent-orange: #FF9800;
            --accent-cyan: #00BCD4;
            
            --shadow-xs: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.08);
            --shadow-md: 0 6px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 10px 28px rgba(0,0,0,0.16);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.2);
            --shadow-glow: 0 0 30px rgba(255, 215, 0, 0.3);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
            --radius-full: 9999px;
            
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            --container-max: 420px;
        }
        
        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--dark-bg);
            color: var(--gray-100);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* === MAIN CONTAINER === */
        .main-container {
            width: 100%;
            max-width: var(--container-max);
            margin: 0 auto;
        }
        
        .profile-container {
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: 0;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }
        
        .profile-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, 
                var(--primary-yellow), 
                var(--accent-orange),
                var(--primary-yellow)
            );
            background-size: 200% 100%;
            animation: shimmer 3s infinite linear;
        }
        
        /* === HEADER COMPACT AVEC BOUTON COMPTE === */
        .app-header {
            background: linear-gradient(135deg, #000000 0%, #111111 100%);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            position: relative;
        }
        
        .logo-wrapper {
            position: relative;
            width: 70px;
            height: 70px;
            flex-shrink: 0;
        }
        
        .logo-image {
            width: 100%;
            height: 100%;
            border-radius: var(--radius-lg);
            border: 2px solid var(--primary-yellow);
            object-fit: cover;
            background: var(--gray-900);
            box-shadow: var(--shadow-md);
            cursor: pointer;
        }
        
        .logo-star {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--primary-yellow), #FFC107);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 
                0 4px 8px rgba(255, 215, 0, 0.3),
                0 0 0 2px rgba(0,0,0,0.8);
            border: 2px solid #000;
            z-index: 3;
            animation: pulse 2s infinite;
        }
        
        .logo-star::before {
            content: '‚òÖ';
            color: var(--primary-black);
            font-size: 16px;
            font-weight: 900;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .header-content {
            flex: 1;
        }
        
        .header-title {
            font-family: 'Bungee Spice', cursive;
            font-size: 26px;
            line-height: 1;
            margin-bottom: 4px;
        }
        
        .header-subtitle {
            font-size: 12px;
            color: var(--gray-400);
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .header-tag {
            display: inline-block;
            background: rgba(255, 215, 0, 0.1);
            color: var(--primary-yellow);
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 600;
        }
        
        /* === BOUTON COMPTE UTILISATEUR === */
        .account-button {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-normal);
            z-index: 10;
            border: 2px solid transparent;
        }
        
        .account-button.connected {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            border-color: rgba(76, 175, 80, 0.3);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
        }
        
        .account-button.disconnected {
            background: linear-gradient(135deg, var(--gray-700), var(--gray-800));
            border-color: rgba(255, 215, 0, 0.2);
        }
        
        .account-button i {
            color: var(--primary-white);
            font-size: 18px;
        }
        
        .account-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }
        
        /* === COMPACT STATUS === */
        .status-bar {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: var(--radius-md);
            padding: 12px 15px;
            margin: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .status-bar:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .status-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-yellow);
            font-family: 'Bungee Spice', cursive;
        }
        
        /* === BOUTON DE LOCALISATION === */
        .location-button {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition-normal);
            margin: 10px auto;
            width: 90%;
            box-shadow: var(--shadow-md);
        }
        
        .location-button:hover {
            background: linear-gradient(135deg, #1976D2, #2196F3);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .location-button:disabled {
            background: var(--gray-600);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .distance-display {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--radius-md);
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            font-size: 14px;
            color: var(--primary-yellow);
            font-weight: 600;
            display: none;
        }
        
        /* === APP STYLE CARDS === */
        .app-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 18px;
            margin: 15px;
            box-shadow: var(--shadow-md);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-white);
            margin-bottom: 15px;
        }
        
        /* === BOUTIQUE DETAILS COMPACT === */
        .shop-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .detail-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            padding: 12px;
            text-align: center;
            transition: var(--transition-fast);
        }
        
        .detail-item:hover {
            background: rgba(255, 215, 0, 0.05);
            transform: translateY(-2px);
        }
        
        .detail-icon {
            font-size: 20px;
            margin-bottom: 8px;
            color: var(--primary-yellow);
        }
        
        .detail-text {
            font-size: 12px;
            color: var(--gray-300);
            line-height: 1.3;
        }
        
        .detail-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-white);
            margin-top: 4px;
        }
        
        /* === DELIVERY MAP COMPACT === */
        .map-container {
            height: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 2px solid rgba(255, 215, 0, 0.2);
            margin-bottom: 10px;
        }
        
        .map-legend {
            display: flex;
            justify-content: space-around;
            font-size: 11px;
            color: var(--gray-400);
            padding: 10px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 1px solid white;
        }
        
        .legend-free { background: #4CAF50; }
        .legend-1eur { background: #FF9800; }
        .legend-2eur { background: #FF5252; }
        .legend-3eur { background: #9C27B0; }
        .legend-5eur { background: #2196F3; }
        
        /* === LIVE TRACKER COMPACT === */
        .tracker-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.05);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 215, 0, 0.1);
        }
        
        .driver-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .tracker-info {
            flex: 1;
        }
        
        .tracker-status {
            display: inline-block;
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .driver-name {
            font-weight: 600;
            color: var(--primary-white);
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        .driver-eta {
            font-size: 12px;
            color: var(--primary-yellow);
        }
        
        /* === PRODUCTS GRID IMPROVED === */
        .products-section {
            padding: 15px;
        }
        
        .category-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: none;
        }
        
        .category-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .category-tab {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray-300);
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .category-tab.active {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.4);
            color: var(--primary-yellow);
        }
        
        .category-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .product-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 15px;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .product-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 215, 0, 0.3);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .product-image-container {
            position: relative;
            width: 100%;
            height: 140px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius-md);
            overflow: hidden;
            margin-bottom: 12px;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;
            transition: var(--transition-normal);
            cursor: pointer;
        }
        
        .product-image:hover {
            transform: scale(1.05);
        }
        
        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            font-size: 10px;
            font-weight: 700;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .product-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--primary-white);
            margin-bottom: 8px;
            line-height: 1.4;
            height: 42px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .product-price {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary-yellow);
            margin-bottom: 12px;
        }
        
        .product-price .original-price {
            font-size: 14px;
            color: var(--gray-500);
            text-decoration: line-through;
            margin-right: 5px;
        }
        
        .product-price .discounted-price {
            color: #4CAF50;
        }
        
        .product-price .client-badge {
            display: inline-block;
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            padding: 2px 6px;
            border-radius: var(--radius-full);
            font-size: 10px;
            font-weight: 700;
            margin-left: 5px;
            vertical-align: middle;
        }
        
        .product-description {
            font-size: 12px;
            color: var(--gray-400);
            margin-bottom: 12px;
            line-height: 1.4;
            height: 34px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .product-details-btn {
            background: rgba(255, 215, 0, 0.1);
            color: var(--primary-yellow);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--radius-md);
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 12px;
            transition: var(--transition-fast);
        }
        
        .product-details-btn:hover {
            background: rgba(255, 215, 0, 0.2);
        }
        
        .product-actions {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }
        
        .quantity-selector {
            flex: 1;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .quantity-btn {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: none;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .quantity-btn:hover {
            background: rgba(255, 215, 0, 0.3);
        }
        
        .quantity-input {
            width: 35px;
            height: 32px;
            text-align: center;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 14px;
            font-weight: 600;
        }
        
        .buy-button {
            flex: 2;
            height: 32px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-normal);
        }
        
        .buy-button:hover {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .buy-button:disabled {
            background: var(--gray-600);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* === TABLEAU DE PRIX DYNAMIQUE POUR √âV√âNEMENTS === */
        .pricing-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }
        
        .pricing-table h4 {
            color: var(--primary-yellow);
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pricing-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .pricing-option:last-child {
            border-bottom: none;
        }
        
        .person-count {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-300);
            font-size: 14px;
        }
        
        .person-count i {
            color: var(--primary-yellow);
        }
        
        .event-price {
            font-weight: 700;
            color: var(--primary-yellow);
            font-size: 18px;
        }
        
        .additional-price {
            font-size: 12px;
            color: var(--accent-green);
            margin-top: 2px;
        }
        
        .price-calculator {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: var(--radius-md);
            padding: 12px;
            margin-top: 10px;
        }
        
        .calculator-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .calculator-input label {
            color: var(--gray-300);
            font-size: 14px;
            flex: 1;
        }
        
        .calculator-input input {
            width: 60px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            color: white;
            text-align: center;
            font-weight: 600;
        }
        
        .calculator-result {
            text-align: center;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: var(--radius-sm);
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .calculator-result span {
            font-weight: 800;
            color: #4CAF50;
            font-size: 18px;
        }
        
        /* === CART BUTTON === */
        .cart-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-yellow), #FF9800);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            transition: var(--transition-normal);
            border: 2px solid var(--card-bg);
        }
        
        .cart-button:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 10px 25px rgba(255, 152, 0, 0.4);
        }
        
        .cart-button i {
            font-size: 24px;
            color: var(--primary-black);
        }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, var(--accent-red), #FF5252);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 800;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid var(--card-bg);
            box-shadow: var(--shadow-sm);
        }
        
        /* === MODALS COMPACT === */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            z-index: 2000;
            animation: fadeIn 0.3s ease-out;
            padding: 15px;
        }
        
        .modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .app-modal {
            background: linear-gradient(135deg, #111111 0%, #1a1a1a 100%);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            animation: modalSlideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: var(--shadow-xl);
            position: relative;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 152, 0, 0.1));
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary-white);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--primary-white);
            width: 35px;
            height: 35px;
            border-radius: var(--radius-full);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }
        
        .modal-close:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.4);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        /* === STORIES SNAPCHAT STYLE === */
        .story-marker {
            background: linear-gradient(45deg, #FFD700, #FF9800);
            border: 3px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: pulse 2s infinite;
            position: relative;
            z-index: 1000;
        }
        
        .story-marker::before {
            content: 'üìπ';
            font-size: 24px;
        }
        
        .story-marker::after {
            content: '5';
            position: absolute;
            top: -5px;
            right: -5px;
            background: #FF5252;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }
        
        /* === STORIES MODAL === */
        .stories-modal {
            max-width: 100% !important;
            height: 100vh !important;
            max-height: 100vh !important;
            border-radius: 0 !important;
            background: #000 !important;
        }
        
        .stories-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .story-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.7);
            position: relative;
            z-index: 10;
        }
        
        .story-shop-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--primary-yellow);
        }
        
        .story-info h3 {
            color: white;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .story-info p {
            color: var(--gray-400);
            font-size: 12px;
        }
        
        .story-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .story-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }
        
        .story-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .story-progress {
            display: flex;
            gap: 5px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .story-progress-bar {
            flex: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-full);
            overflow: hidden;
        }
        
        .story-progress-fill {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .story-progress-fill.active {
            width: 100%;
            animation: storyProgress 10s linear forwards;
        }
        
        .story-nav {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            pointer-events: none;
        }
        
        .story-nav-btn {
            width: 50px;
            height: 100%;
            background: transparent;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            pointer-events: all;
            opacity: 0.7;
            transition: var(--transition-fast);
        }
        
        .story-nav-btn:hover {
            opacity: 1;
            transform: scale(1.2);
        }
        
        /* === CART MODAL === */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-name {
            flex: 2;
            font-weight: 500;
            color: var(--primary-white);
            font-size: 14px;
        }
        
        .cart-item-quantity {
            flex: 1;
            text-align: center;
            font-weight: 600;
            color: var(--primary-white);
            font-size: 14px;
        }
        
        .cart-item-price {
            flex: 1;
            text-align: right;
            font-weight: 700;
            color: var(--primary-yellow);
            font-size: 14px;
        }
        
        .cart-item-remove {
            background: rgba(255, 82, 82, 0.2);
            color: #FF5252;
            border: 1px solid rgba(255, 82, 82, 0.3);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            margin-left: 8px;
            font-size: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition-fast);
        }
        
        .cart-item-remove:hover {
            background: rgba(255, 82, 82, 0.3);
        }
        
        .cart-summary {
            background: rgba(255,215,0,0.1);
            border-radius: var(--radius-lg);
            padding: 15px;
            margin: 15px 0;
        }
        
        .cart-total {
            font-size: 24px;
            font-weight: 900;
            text-align: right;
            color: var(--primary-yellow);
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .checkout-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent-orange), #FF5722);
            color: var(--primary-white);
            border: none;
            border-radius: var(--radius-lg);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: var(--transition-normal);
        }
        
        .checkout-button:hover {
            background: linear-gradient(135deg, #FF5722, var(--accent-orange));
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 87, 34, 0.4);
        }
        
        /* === PAYPAL BUTTON === */
        .paypal-button {
            width: 100%;
            margin-top: 15px;
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        /* === CHECKOUT FORM COMPACT === */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            color: var(--gray-300);
            font-weight: 600;
            font-size: 13px;
        }
        
        .form-input, .form-textarea, .form-select, .form-datetime {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            color: var(--primary-white);
            font-size: 14px;
            transition: var(--transition-fast);
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus, .form-datetime:focus {
            outline: none;
            border-color: var(--primary-yellow);
            background: rgba(255, 215, 0, 0.05);
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px;
        }
        
        .form-datetime {
            padding: 11px 12px;
        }
        
        .form-datetime::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .radio-option:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }
        
        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-yellow);
        }
        
        .radio-option label {
            flex: 1;
            color: var(--primary-white);
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* === PRODUCT DETAIL MODAL === */
        .product-detail-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
            background: rgba(0,0,0,0.3);
            border-radius: var(--radius-md);
            margin-bottom: 15px;
        }
        
        .product-detail-name {
            font-size: 22px;
            font-weight: 800;
            color: var(--primary-white);
            margin-bottom: 10px;
        }
        
        .product-detail-price {
            font-size: 28px;
            font-weight: 900;
            color: var(--primary-yellow);
            margin-bottom: 15px;
        }
        
        .product-detail-description {
            color: var(--gray-300);
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .product-detail-specs {
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .product-detail-specs h4 {
            color: var(--primary-white);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .product-detail-specs ul {
            list-style: none;
            padding-left: 0;
        }
        
        .product-detail-specs li {
            color: var(--gray-300);
            font-size: 13px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* === MODAL COMPTE UTILISATEUR === */
        .account-modal {
            max-width: 350px !important;
        }
        
        .client-badge {
            display: inline-block;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 700;
            margin-left: 8px;
        }
        
        .client-info {
            background: rgba(255, 215, 0, 0.1);
            border-radius: var(--radius-lg);
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .client-name {
            font-size: 18px;
            font-weight: 800;
            color: var(--primary-white);
            margin-bottom: 5px;
        }
        
        .client-details {
            color: var(--gray-300);
            font-size: 14px;
        }
        
        .order-history {
            margin-top: 20px;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid var(--primary-yellow);
        }
        
        .history-date {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 5px;
        }
        
        .history-total {
            font-weight: 700;
            color: var(--primary-yellow);
            font-size: 16px;
        }
        
        /* === ANIMATIONS === */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 4px 8px rgba(255, 215, 0, 0.3),
                    0 0 0 2px rgba(0,0,0,0.8);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 
                    0 4px 12px rgba(255, 215, 0, 0.5),
                    0 0 0 2px rgba(0,0,0,0.8),
                    0 0 15px rgba(255, 215, 0, 0.3);
            }
        }
        
        @keyframes storyProgress {
            from { width: 0%; }
            to { width: 100%; }
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translate(-50%, -100%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        @keyframes slideOutUp {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            to {
                opacity: 0;
                transform: translate(-50%, -100%);
            }
        }
        
        /* === RESPONSIVE DESIGN === */
        @media (max-width: 480px) {
            .app-header {
                padding: 15px;
            }
            
            .logo-wrapper {
                width: 60px;
                height: 60px;
            }
            
            .header-title {
                font-size: 22px;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .product-image-container {
                height: 160px;
            }
            
            .map-container {
                height: 220px;
            }
            
            .cart-button {
                width: 55px;
                height: 55px;
                bottom: 15px;
                right: 15px;
            }
            
            .cart-button i {
                font-size: 22px;
            }
            
            .logo-star {
                width: 26px;
                height: 26px;
                bottom: -3px;
                right: -3px;
            }
            
            .logo-star::before {
                font-size: 14px;
            }
            
            .account-button {
                width: 35px;
                height: 35px;
                top: 10px;
                right: 10px;
            }
            
            .account-button i {
                font-size: 16px;
            }
        }
        
        @media (max-width: 360px) {
            .header-title {
                font-size: 20px;
            }
            
            .shop-details {
                grid-template-columns: 1fr;
            }
            
            .product-name {
                font-size: 14px;
                height: 40px;
            }
        }
        
        /* === UTILITY CLASSES === */
        .hidden {
            display: none !important;
        }
        
        .visible {
            display: block !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-10 {
            margin-top: 10px;
        }
        
        .mt-15 {
            margin-top: 15px;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mb-10 {
            margin-bottom: 10px;
        }
        
        .mb-15 {
            margin-bottom: 15px;
        }
        
        /* === SCROLLBAR STYLING === */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--primary-yellow), #FF9800);
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(#FF9800, var(--primary-yellow));
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="main-container">
        <div class="profile-container">
            
            <!-- App Header avec bouton compte -->
            <div class="app-header">
                <div class="logo-wrapper">
                    <img src="https://mcusercontent.com/40a9f1a77d46874eba2309d88/images/89a59702-cad3-dfb7-580d-22fb843f8d3f.jpeg" 
                         alt="H.D.S SHOP Logo" 
                         class="logo-image" 
                         id="logoImage">
                    <div class="logo-star"></div>
                </div>
                
                <div class="header-content">
                    <div class="header-title">H.D.S SHOP</div>
                    <div class="header-subtitle">ORGANISATION √âV√âNEMENTS & BOUTIQUE PREMIUM</div>
                    <div class="header-tag">SERVICE 24H/24</div>
                </div>
                
                <!-- Bouton compte utilisateur -->
                <div class="account-button disconnected" id="accountButton" onclick="openAccountModal()">
                    <i class="fas fa-user"></i>
                </div>
            </div>
            
            <!-- Status Bar -->
            <div class="status-bar" id="statusText">
                <div class="status-text">üéâ Organisation √âv√©nements Marseille</div>
            </div>
            
            <!-- App Card: Boutique Details -->
            <div class="app-card">
                <div class="card-title">
                    <i class="fas fa-store"></i>
                    D√©tails de la boutique
                </div>
                
                <div class="shop-details">
                    <div class="detail-item">
                        <div class="detail-icon">‚≠ê</div>
                        <div class="detail-text">√âvaluations</div>
                        <div class="detail-value">4.9/5</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-icon">üë•</div>
                        <div class="detail-text">√âv√©nements</div>
                        <div class="detail-value">500+</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-icon">üöö</div>
                        <div class="detail-text">Livraison</div>
                        <div class="detail-value">Gratuite √† 50‚Ç¨</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-icon">üí∞</div>
                        <div class="detail-text">Frais min</div>
                        <div class="detail-value">2‚Ç¨ - 8‚Ç¨</div>
                    </div>
                </div>
                
                <div class="detail-text text-center mt-10" style="color: var(--accent-red);">
                    Organisation compl√®te d'√©v√©nements sur Marseille
                </div>
            </div>
            
            <!-- App Card: Carte des Zones avec Localisation -->
            <div class="app-card">
                <div class="card-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Zones de livraison
                </div>
                
                <!-- Bouton de localisation -->
                <button class="location-button" id="locateMeButton" onclick="locateUser()">
                    <i class="fas fa-location-dot"></i>
                    Me localiser
                </button>
                
                <!-- Affichage de distance -->
                <div class="distance-display" id="distanceDisplay">
                    <i class="fas fa-ruler"></i>
                    <span id="distanceText">Distance en cours de calcul...</span>
                </div>
                
                <div class="map-container" id="deliveryMap"></div>
                
                <div class="map-legend">
                    <div class="legend-item">
                        <div class="legend-dot legend-free"></div>
                        <span>Gratuite</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot legend-1eur"></div>
                        <span>2-3‚Ç¨</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot legend-3eur"></div>
                        <span>4-5‚Ç¨</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot legend-5eur"></div>
                        <span>6-8‚Ç¨</span>
                    </div>
                </div>
            </div>
            
            <!-- App Card: Suivi Livraison -->
            <div class="app-card" id="trackerCard">
                <div class="card-title">
                    <i class="fas fa-shipping-fast"></i>
                    Suivi en direct
                </div>
                
                <div class="tracker-container">
                    <div class="driver-avatar">M</div>
                    <div class="tracker-info">
                        <div class="tracker-status" id="deliveryStatus">En attente</div>
                        <div class="driver-name">Mohamed - Livreur #HDS23</div>
                        <div class="driver-eta" id="driverETA">üìç Pr√™t pour livraison</div>
                    </div>
                </div>
                
                <button class="checkout-button mt-15" id="followDeliveryButton" onclick="openDeliveryTrackerModal()" style="display: none;">
                    <i class="fas fa-map-marker-alt"></i>
                    Suivre ma livraison
                </button>
            </div>
            
            <!-- Products Section -->
            <div class="products-section">
                <h2 class="card-title" style="margin: 0 0 15px 0;">
                    <i class="fas fa-shopping-bag"></i>
                    Produits & √âv√©nements
                </h2>
                
                <!-- Category Tabs avec onglet Populaires -->
                <div class="category-tabs" id="categoryTabs">
                    <div class="category-tab active" data-category="all">Tous</div>
                    <div class="category-tab" data-category="evenements">üéä √âv√©nements</div>
                    <div class="category-tab" data-category="accessoires">üî• Populaires</div>
                    <div class="category-tab" data-category="repas">üçΩÔ∏è Repas</div>
                    <div class="category-tab" data-category="catering">üë®‚Äçüç≥ Catering</div>
                    <div class="category-tab" data-category="boissons">ü•§ Boissons</div>
                    <div class="category-tab" data-category="alcools">üçæ Alcools</div>
                </div>
                
                <!-- Products Grid -->
                <div class="products-grid" id="productsGrid">
                    <!-- Produits charg√©s dynamiquement -->
                </div>
            </div>
            
            <!-- Footer -->
            <div style="padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center;">
                <div style="font-size: 11px; color: var(--gray-500); margin-bottom: 5px;">
                    ¬© 2024 H.D.S SHOP - Tous droits r√©serv√©s
                </div>
                <div style="font-size: 10px; color: var(--gray-600);">
                    Marseille ‚Ä¢ Organisation √©v√©nements ‚Ä¢ Paiement s√©curis√©
                </div>
                <div style="margin-top: 10px;">
                    <img src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_37x23.jpg" 
                         alt="PayPal" 
                         style="height: 20px; margin: 0 5px;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/2560px-Visa_Inc._logo.svg.png" 
                         alt="Visa" 
                         style="height: 15px; margin: 0 5px;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/1280px-Mastercard-logo.svg.png" 
                         alt="Mastercard" 
                         style="height: 15px; margin: 0 5px;">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Cart Button -->
    <div class="cart-button" id="openCartButton">
        <i class="fas fa-shopping-cart"></i>
        <div class="cart-count" id="cartCount">0</div>
    </div>
    
    <!-- Cart Modal -->
    <div class="modal-overlay" id="cartModalOverlay">
        <div class="app-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-shopping-cart"></i>
                    Mon Panier
                </div>
                <button class="modal-close" onclick="closeCart()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="cartItems"></div>
                
                <div class="cart-summary">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: var(--gray-400); font-size: 14px;">Sous-total</span>
                        <span style="font-weight: 600; color: white; font-size: 14px;" id="subtotal">0‚Ç¨</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: var(--gray-400); font-size: 14px;">R√©duction client</span>
                        <span style="font-weight: 600; color: #4CAF50; font-size: 14px;" id="clientDiscount">0‚Ç¨</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--gray-400); font-size: 14px;">Livraison</span>
                        <span style="font-weight: 600; color: #4CAF50; font-size: 14px;" id="deliveryCost">Gratuit</span>
                    </div>
                </div>
                
                <div class="cart-total" id="cartTotal">Total : 0‚Ç¨</div>
                
                <button class="checkout-button" onclick="checkout()">
                    <i class="fas fa-lock"></i>
                    Commander maintenant
                </button>
            </div>
        </div>
    </div>
    
    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModalOverlay">
        <div class="app-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-lock"></i>
                    Finaliser la commande
                </div>
                <button class="modal-close" onclick="closeCheckout()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="checkoutForm" action="https://formspree.io/f/xnnbwjpe" method="POST">
                    <div class="form-group">
                        <label class="form-label">Informations personnelles</label>
                        <input type="text" name="nom" class="form-input" placeholder="Nom complet" required>
                        <input type="tel" name="telephone" class="form-input mt-10" placeholder="T√©l√©phone" required>
                        <textarea name="adresse" class="form-textarea mt-10" placeholder="Adresse compl√®te √† Marseille" required></textarea>
                    </div>
                    
                    <!-- Planification d'√©v√©nement -->
                    <div class="form-group">
                        <label class="form-label">Type d'√©v√©nement</label>
                        <select name="type_evenement" class="form-select">
                            <option value="">S√©lectionnez un type</option>
                            <option value="anniversaire_enfant">üéÇ Anniversaire Enfant (5-12 ans)</option>
                            <option value="anniversaire_ado">üéÆ Anniversaire Ado (13-17 ans)</option>
                            <option value="anniversaire_adultes">ü•≥ Anniversaire Adultes</option>
                            <option value="soiree_entreprise">üíº Soir√©e Entreprise</option>
                            <option value="mariage">üíç Mariage</option>
                            <option value="soiree_privee">üéâ Soir√©e Priv√©e</option>
                            <option value="baby_shower">üë∂ Baby Shower</option>
                            <option value="evenement_pro">üè¢ √âv√©nement Professionnel</option>
                        </select>
                    </div>
                    
                    <!-- Tableau de prix dynamique pour √©v√©nements -->
                    <div class="pricing-table" id="eventPricingTable" style="display: none;">
                        <h4><i class="fas fa-calculator"></i> Tableau des prix</h4>
                        <div class="pricing-option">
                            <div class="person-count">
                                <i class="fas fa-user"></i>
                                <span>1-10 personnes</span>
                            </div>
                            <div>
                                <div class="event-price">150‚Ç¨</div>
                                <div class="additional-price">Base</div>
                            </div>
                        </div>
                        <div class="pricing-option">
                            <div class="person-count">
                                <i class="fas fa-user-friends"></i>
                                <span>11-20 personnes</span>
                            </div>
                            <div>
                                <div class="event-price">250‚Ç¨</div>
                                <div class="additional-price">+10‚Ç¨/pers</div>
                            </div>
                        </div>
                        <div class="pricing-option">
                            <div class="person-count">
                                <i class="fas fa-users"></i>
                                <span>21-30 personnes</span>
                            </div>
                            <div>
                                <div class="event-price">350‚Ç¨</div>
                                <div class="additional-price">+10‚Ç¨/pers</div>
                            </div>
                        </div>
                        <div class="pricing-option">
                            <div class="person-count">
                                <i class="fas fa-crowd"></i>
                                <span>31-50 personnes</span>
                            </div>
                            <div>
                                <div class="event-price">500‚Ç¨</div>
                                <div class="additional-price">+12‚Ç¨/pers</div>
                            </div>
                        </div>
                        
                        <!-- Calculateur de prix -->
                        <div class="price-calculator">
                            <div class="calculator-input">
                                <label>Nombre de personnes :</label>
                                <input type="number" id="personCount" min="1" max="100" value="10" onchange="calculateEventPrice()">
                            </div>
                            <div class="calculator-result">
                                Prix estim√© : <span id="estimatedPrice">150‚Ç¨</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date et heure de l'√©v√©nement</label>
                        <input type="datetime-local" name="date_evenement" class="form-datetime" min="<?php echo date('Y-m-d\TH:i'); ?>">
                        <small style="color: var(--gray-500); font-size: 11px; display: block; margin-top: 5px;">Planifiez votre √©v√©nement √† l'avance</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nombre de personnes</label>
                        <select name="nombre_personnes" class="form-select" onchange="updateEventPricing()">
                            <option value="1-10">1-10 personnes</option>
                            <option value="11-20">11-20 personnes</option>
                            <option value="21-30">21-30 personnes</option>
                            <option value="31-50">31-50 personnes</option>
                            <option value="51-100">51-100 personnes</option>
                            <option value="100+">100+ personnes</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">M√©thode de paiement</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="cash" name="paiement" value="Esp√®ces" checked>
                                <label for="cash">Esp√®ces √† la livraison</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="card" name="paiement" value="Carte Bancaire">
                                <label for="card">Carte bancaire (PayPal)</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section PayPal -->
                    <div id="paypal-button-container" style="display: none; margin-top: 15px;"></div>
                    
                    <div class="form-group">
                        <label class="form-label">Instructions sp√©ciales</label>
                        <textarea name="instructions" class="form-textarea" placeholder="Th√®me de l'√©v√©nement, allergies alimentaires, pr√©f√©rences, d√©corations sp√©ciales..."></textarea>
                    </div>
                    
                    <!-- Champs cach√©s pour les d√©tails de commande -->
                    <input type="hidden" name="details_commande" id="orderDetails">
                    <input type="hidden" name="code_confirmation" id="confirmationCodeInput">
                    <input type="hidden" name="total_commande" id="totalOrderInput">
                    <input type="hidden" name="frais_livraison" id="deliveryFeeInput">
                    <input type="hidden" name="nombre_articles" id="itemCountInput">
                    <input type="hidden" name="reduction_client" id="clientDiscountInput">
                    
                    <!-- Protection Formspree -->
                    <input type="text" name="_gotcha" style="display:none">
                    <input type="hidden" name="_subject" value="Nouvelle commande H.D.S SHOP - √âv√©nement Marseille">
                    <input type="hidden" name="_template" value="table">
                    <input type="hidden" name="_language" value="fr">
                    
                    <button type="button" class="checkout-button" onclick="submitOrder()">
                        <i class="fas fa-check-circle"></i>
                        Confirmer la commande
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmationModalOverlay">
        <div class="app-modal">
            <div class="modal-header" style="background: linear-gradient(135deg, rgba(76,175,80,0.2), rgba(46,125,50,0.2));">
                <div class="modal-title">
                    <i class="fas fa-check-circle"></i>
                    Commande confirm√©e
                </div>
                <button class="modal-close" onclick="closeConfirmation()">√ó</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <div style="font-size: 60px; margin-bottom: 15px;">üéâ</div>
                <div style="font-size: 22px; font-weight: 800; color: white; margin-bottom: 10px;">Code de confirmation</div>
                
                <div style="background: rgba(255,215,0,0.1); border: 2px dashed var(--primary-yellow); border-radius: var(--radius-lg); padding: 20px; margin: 20px 0;">
                    <div style="font-size: 14px; color: var(--gray-400); margin-bottom: 8px;">MONTRER AU LIVREUR</div>
                    <div style="font-size: 36px; font-weight: 800; color: var(--primary-yellow); letter-spacing: 5px; margin-bottom: 10px;" id="confirmationCode">HDS-8542</div>
                    <div style="font-size: 12px; color: var(--gray-400);">Capture d'√©cran recommand√©e</div>
                </div>
                
                <div style="display: grid; gap: 12px; margin-bottom: 20px;">
                    <div style="text-align: left; background: rgba(255,255,255,0.05); padding: 12px; border-radius: var(--radius-md);">
                        <div style="font-size: 11px; color: var(--gray-400); margin-bottom: 4px;">Temps estim√©</div>
                        <div style="font-weight: 700; color: white;" id="deliveryTimeEstimate">30-45 minutes</div>
                    </div>
                    <div style="text-align: left; background: rgba(255,255,255,0.05); padding: 12px; border-radius: var(--radius-md);">
                        <div style="font-size: 11px; color: var(--gray-400); margin-bottom: 4px;">Livreur</div>
                        <div style="font-weight: 700; color: white;" id="deliveryDriver">Mohamed #HDS23</div>
                    </div>
                </div>
                
                <p style="color: var(--gray-400); font-size: 13px; line-height: 1.5; margin-bottom: 20px;">
                    Montrez votre code au livreur et pr√©parez le paiement.
                </p>
                
                <button class="checkout-button" onclick="validateAndCloseConfirmation()">
                    <i class="fas fa-check"></i>
                    Valider la commande
                </button>
                
                <button class="checkout-button mt-10" style="background: rgba(255,255,255,0.1);" onclick="startRealisticDeliveryTracker()">
                    <i class="fas fa-shipping-fast"></i>
                    Suivre la livraison
                </button>
            </div>
        </div>
    </div>
    
    <!-- Stories Snapchat Style Modal -->
    <div class="modal-overlay" id="storiesModalOverlay">
        <div class="app-modal stories-modal">
            <div class="stories-container">
                <!-- Header des stories -->
                <div class="story-header">
                    <img src="https://mcusercontent.com/40a9f1a77d46874eba2309d88/images/89a59702-cad3-dfb7-580d-22fb843f8d3f.jpeg" 
                         alt="H.D.S SHOP" 
                         class="story-shop-logo">
                    <div class="story-info">
                        <h3>H.D.S SHOP Stories</h3>
                        <p>√âv√©nements Marseille ‚Ä¢ Il y a 3h</p>
                    </div>
                    <button class="modal-close" onclick="closeStories()" style="margin-left: auto;">√ó</button>
                </div>
                
                <!-- Barre de progression -->
                <div class="story-progress">
                    <div class="story-progress-bar">
                        <div class="story-progress-fill" id="storyProgress1"></div>
                    </div>
                    <div class="story-progress-bar">
                        <div class="story-progress-fill" id="storyProgress2"></div>
                    </div>
                    <div class="story-progress-bar">
                        <div class="story-progress-fill" id="storyProgress3"></div>
                    </div>
                    <div class="story-progress-bar">
                        <div class="story-progress-fill" id="storyProgress4"></div>
                    </div>
                    <div class="story-progress-bar">
                        <div class="story-progress-fill" id="storyProgress5"></div>
                    </div>
                </div>
                
                <!-- Contenu des stories -->
                <div class="story-content">
                    <div class="story-nav">
                        <button class="story-nav-btn" onclick="prevStory()">‚Äπ</button>
                        <button class="story-nav-btn" onclick="nextStory()">‚Ä∫</button>
                    </div>
                    
                    <!-- Story 1 - Vid√©o verticale -->
                    <div class="story-slide active" id="storySlide1">
                        <video controls class="story-video" poster="https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80">
                            <source src="https://assets.mixkit.co/videos/preview/mixkit-night-drive-through-a-city-41554-large.mp4" type="video/mp4">
                        </video>
                        <div style="position: absolute; bottom: 100px; left: 20px; right: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: var(--radius-md);">
                            <h3 style="color: white; margin-bottom: 5px;">üéâ ORGANISATION √âV√âNEMENTS</h3>
                            <p style="color: var(--gray-300); font-size: 14px;">Soir√©es priv√©es, anniversaires, √©v√©nements pros sur Marseille</p>
                        </div>
                    </div>
                    
                    <!-- Story 2 - Image anniversaire enfant -->
                    <div class="story-slide" id="storySlide2" style="display: none;">
                        <img src="https://images.unsplash.com/photo-1530103862676-de8c9debad1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" 
                             alt="Anniversaire enfant" 
                             class="story-image">
                        <div style="position: absolute; bottom: 100px; left: 20px; right: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: var(--radius-md);">
                            <h3 style="color: white; margin-bottom: 5px;">üéÇ ANNIVERSAIRE ENFANT</h3>
                            <p style="color: var(--gray-300); font-size: 14px;">Organisation compl√®te avec animations, jeux et d√©coration</p>
                        </div>
                    </div>
                    
                    <!-- Story 3 - Image √©v√©nement entreprise -->
                    <div class="story-slide" id="storySlide3" style="display: none;">
                        <img src="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" 
                             alt="√âv√©nement entreprise" 
                             class="story-image">
                        <div style="position: absolute; bottom: 100px; left: 20px; right: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: var(--radius-md);">
                            <h3 style="color: white; margin-bottom: 5px;">üíº √âV√âNEMENTS ENTREPRISE</h3>
                            <p style="color: var(--gray-300); font-size: 14px;">Catering professionnel pour vos r√©unions et soir√©es d'entreprise</p>
                        </div>
                    </div>
                    
                    <!-- Story 4 - Vid√©o mariage -->
                    <div class="story-slide" id="storySlide4" style="display: none;">
                        <video controls class="story-video" poster="https://images.unsplash.com/photo-1465495976277-4387d4b0e4a6?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80">
                            <source src="https://assets.mixkit.co/videos/preview/mixkit-wedding-couple-in-love-41553-large.mp4" type="video/mp4">
                        </video>
                        <div style="position: absolute; bottom: 100px; left: 20px; right: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: var(--radius-md);">
                            <h3 style="color: white; margin-bottom: 5px;">üíç ORGANISATION MARIAGE</h3>
                            <p style="color: var(--gray-300); font-size: 14px;">Service complet pour votre jour sp√©cial</p>
                        </div>
                    </div>
                    
                    <!-- Story 5 - Image produits -->
                    <div class="story-slide" id="storySlide5" style="display: none;">
                        <img src="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" 
                             alt="Produits premium" 
                             class="story-image">
                        <div style="position: absolute; bottom: 100px; left: 20px; right: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: var(--radius-md);">
                            <h3 style="color: white; margin-bottom: 5px;">üõí PRODUITS PREMIUM</h3>
                            <p style="color: var(--gray-300); font-size: 14px;">Boissons √©nergisantes, accessoires, kits soir√©e et plus</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Product Detail Modal -->
    <div class="modal-overlay" id="productDetailModal">
        <div class="app-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-info-circle"></i>
                    D√©tails du produit
                </div>
                <button class="modal-close" onclick="closeProductDetail()">√ó</button>
            </div>
            <div class="modal-body">
                <img id="detailProductImage" src="" alt="Produit" class="product-detail-image">
                
                <h2 id="detailProductName" class="product-detail-name"></h2>
                <div id="detailProductPrice" class="product-detail-price"></div>
                
                <div id="detailProductDescription" class="product-detail-description"></div>
                
                <div class="product-detail-specs" id="detailProductSpecs">
                    <!-- Sp√©cifications charg√©es dynamiquement -->
                </div>
                
                <!-- Tableau de prix pour √©v√©nements -->
                <div class="pricing-table" id="detailPricingTable" style="display: none;">
                    <h4><i class="fas fa-calculator"></i> Tarification √âv√©nement</h4>
                    <div class="pricing-option">
                        <div class="person-count">
                            <i class="fas fa-user"></i>
                            <span>1-10 personnes</span>
                        </div>
                        <div>
                            <div class="event-price" id="priceBase">150‚Ç¨</div>
                            <div class="additional-price">Base</div>
                        </div>
                    </div>
                    <div class="pricing-option">
                        <div class="person-count">
                            <i class="fas fa-user-friends"></i>
                            <span>Suppl√©ment par personne</span>
                        </div>
                        <div>
                            <div class="event-price" id="priceExtra">10‚Ç¨</div>
                            <div class="additional-price">au-del√† de 10</div>
                        </div>
                    </div>
                    
                    <!-- Calculateur de prix dans le d√©tail -->
                    <div class="price-calculator">
                        <div class="calculator-input">
                            <label>Nombre de personnes :</label>
                            <input type="number" id="detailPersonCount" min="1" max="100" value="10" onchange="calculateDetailPrice()">
                        </div>
                        <div class="calculator-result">
                            Prix total : <span id="detailEstimatedPrice">150‚Ç¨</span>
                        </div>
                    </div>
                </div>
                
                <div class="product-actions">
                    <div class="quantity-selector">
                        <button class="quantity-btn" onclick="detailDecrementQuantity()">-</button>
                        <input type="number" id="detailQuantityInput" value="1" min="1" class="quantity-input">
                        <button class="quantity-btn" onclick="detailIncrementQuantity()">+</button>
                    </div>
                    <button class="buy-button" id="detailBuyButton" onclick="addToCartFromDetail()">
                        Ajouter au panier
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Account Modal -->
    <div class="modal-overlay" id="accountModalOverlay">
        <div class="app-modal account-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-user"></i>
                    Mon Compte
                </div>
                <button class="modal-close" onclick="closeAccountModal()">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Section connexion/inscription -->
                <div id="loginSection">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üîê</div>
                        <h3 style="color: var(--primary-white); margin-bottom: 5px;">Connexion Client</h3>
                        <p style="color: var(--gray-400); font-size: 13px;">Acc√©dez √† vos avantages exclusifs</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Code client √† 4 chiffres</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="clientCode" class="form-input" placeholder="1234" maxlength="4" style="text-align: center; letter-spacing: 10px; font-size: 24px; font-weight: 700;">
                            <button class="checkout-button" onclick="loginClient()" style="flex: 0 0 auto; padding: 0 20px;">
                                <i class="fas fa-sign-in-alt"></i>
                            </button>
                        </div>
                        <small style="color: var(--gray-500); font-size: 11px; display: block; margin-top: 5px;">Entrez votre code √† 4 chiffres</small>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <p style="color: var(--gray-400); font-size: 13px;">Pas encore de compte ?</p>
                        <button class="checkout-button" onclick="showRegistration()" style="background: var(--gray-600); margin-top: 10px;">
                            <i class="fas fa-user-plus"></i>
                            Cr√©er un compte
                        </button>
                    </div>
                </div>
                
                <!-- Section inscription -->
                <div id="registerSection" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üéÅ</div>
                        <h3 style="color: var(--primary-white); margin-bottom: 5px;">Inscription Client</h3>
                        <p style="color: var(--gray-400); font-size: 13px;">-5% sur toutes vos commandes</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nom complet</label>
                        <input type="text" id="registerName" class="form-input" placeholder="Votre nom">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">T√©l√©phone</label>
                        <input type="tel" id="registerPhone" class="form-input" placeholder="06 12 34 56 78">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Choisissez un code √† 4 chiffres</label>
                        <input type="text" id="registerCode" class="form-input" placeholder="0000" maxlength="4" style="text-align: center; letter-spacing: 10px; font-size: 24px; font-weight: 700;">
                    </div>
                    
                    <div style="background: rgba(255, 215, 0, 0.1); border-radius: var(--radius-md); padding: 12px; margin-bottom: 20px;">
                        <div style="color: var(--primary-yellow); font-weight: 600; margin-bottom: 5px; font-size: 14px;">üéÅ Avantages clients :</div>
                        <ul style="color: var(--gray-300); font-size: 12px; padding-left: 20px; margin: 0;">
                            <li>-5% sur toutes les commandes</li>
                            <li>Historique de vos commandes</li>
                            <li>Suivi prioritaire des livraisons</li>
                            <li>Offres exclusives</li>
                        </ul>
                    </div>
                    
                    <button class="checkout-button" onclick="registerClient()">
                        <i class="fas fa-check"></i>
                        Cr√©er mon compte
                    </button>
                    
                    <button class="checkout-button mt-10" style="background: var(--gray-600);" onclick="showLogin()">
                        <i class="fas fa-arrow-left"></i>
                        Retour √† la connexion
                    </button>
                </div>
                
                <!-- Section compte connect√© -->
                <div id="clientSection" style="display: none;">
                    <div class="client-info">
                        <div class="client-name" id="clientName">Mohamed Ali</div>
                        <div class="client-details">
                            <div><i class="fas fa-phone"></i> <span id="clientPhone">06 12 34 56 78</span></div>
                            <div><i class="fas fa-id-card"></i> Code client : <span id="clientCodeDisplay">1234</span></div>
                            <div><i class="fas fa-percentage"></i> R√©duction : <span class="client-badge">-5%</span></div>
                        </div>
                    </div>
                    
                    <div class="order-history">
                        <h4 style="color: var(--primary-white); margin-bottom: 15px; font-size: 16px;">
                            <i class="fas fa-history"></i>
                            Historique des commandes
                        </h4>
                        <div id="orderHistory">
                            <!-- Commandes charg√©es dynamiquement -->
                        </div>
                    </div>
                    
                    <button class="checkout-button mt-20" onclick="logoutClient()" style="background: var(--gray-700);">
                        <i class="fas fa-sign-out-alt"></i>
                        D√©connexion
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delivery Tracker Modal -->
    <div class="modal-overlay" id="deliveryTrackerModalOverlay">
        <div class="app-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-shipping-fast"></i>
                    Suivi en direct
                </div>
                <button class="modal-close" onclick="closeDeliveryTrackerModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 40px; margin-bottom: 10px;">üìç</div>
                    <div style="font-size: 18px; font-weight: 700; color: white; margin-bottom: 5px;">Votre commande #<span id="modalOrderCode">000</span></div>
                    <div style="color: var(--gray-400); font-size: 14px;">Code: <span id="modalConfirmationCode" style="color: var(--primary-yellow); font-weight: 700;">000</span></div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); border-radius: var(--radius-lg); padding: 15px; margin-bottom: 20px;">
                    <div style="width: 45px; height: 45px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: white; font-size: 16px;">
                        M
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: white; margin-bottom: 4px; font-size: 14px;" id="modalDriverName">Mohamed</div>
                        <div style="font-size: 12px; color: var(--primary-yellow);" id="modalDriverPhone">06 ** ** ** **</div>
                    </div>
                </div>
                
                <div style="background: rgba(255, 152, 0, 0.1); border: 1px solid rgba(255, 152, 0, 0.2); border-radius: var(--radius-lg); padding: 15px; margin-bottom: 20px;">
                    <div style="font-size: 14px; font-weight: 700; color: var(--accent-orange); margin-bottom: 8px;">Temps estim√©</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-clock" style="color: var(--primary-yellow);"></i>
                        <span style="color: white; font-weight: 600;" id="modalDeliveryTime">35 minutes</span>
                    </div>
                </div>
                
                <!-- Progress Tracker -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="font-size: 14px; font-weight: 600; color: white;">Progression</span>
                        <span style="font-size: 14px; font-weight: 700; color: var(--primary-yellow);" id="modalDeliveryStatus">En pr√©paration</span>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); height: 6px; border-radius: var(--radius-full); margin-bottom: 20px; overflow: hidden;">
                        <div id="modalDeliveryProgress" style="height: 100%; background: linear-gradient(90deg, #4CAF50, #2196F3); border-radius: var(--radius-full); width: 0%; transition: width 0.3s;"></div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; position: relative;">
                        <div style="display: flex; flex-direction: column; align-items: center; z-index: 2;">
                            <div id="modalStep1" style="width: 20px; height: 20px; border-radius: 50%; background: var(--primary-white); border: 2px solid #4CAF50; margin-bottom: 5px;"></div>
                            <div style="font-size: 11px; font-weight: 600; color: var(--gray-300);">Commande</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; z-index: 2;">
                            <div id="modalStep2" style="width: 20px; height: 20px; border-radius: 50%; background: var(--primary-white); border: 2px solid var(--gray-400); margin-bottom: 5px;"></div>
                            <div style="font-size: 11px; font-weight: 600; color: var(--gray-300);">Pr√©paration</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; z-index: 2;">
                            <div id="modalStep3" style="width: 20px; height: 20px; border-radius: 50%; background: var(--primary-white); border: 2px solid var(--gray-400); margin-bottom: 5px;"></div>
                            <div style="font-size: 11px; font-weight: 600; color: var(--gray-300);">Livraison</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; z-index: 2;">
                            <div id="modalStep4" style="width: 20px; height: 20px; border-radius: 50%; background: var(--primary-white); border: 2px solid var(--gray-400); margin-bottom: 5px;"></div>
                            <div style="font-size: 11px; font-weight: 600; color: var(--gray-300);">Livr√©</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; font-weight: 700; color: white; margin-bottom: 10px;">Instructions</div>
                    <ul style="list-style: none; padding-left: 0;">
                        <li style="color: var(--gray-300); font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-money-bill-wave" style="color: #4CAF50;"></i>
                            Pr√©parez l'argent en esp√®ces
                        </li>
                        <li style="color: var(--gray-300); font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-phone" style="color: #2196F3;"></i>
                            Restez disponible au t√©l√©phone
                        </li>
                        <li style="color: var(--gray-300); font-size: 13px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-qrcode" style="color: var(--primary-yellow);"></i>
                            Ayez votre code de confirmation
                        </li>
                    </ul>
                </div>
                
                <button class="checkout-button" onclick="startRealisticDeliveryTracker()">
                    <i class="fas fa-play"></i>
                    D√©marrer le suivi
                </button>
                
                <button class="checkout-button mt-10" style="background: var(--gray-600);" onclick="closeDeliveryTrackerModal()">
                    <i class="fas fa-times"></i>
                    Fermer
                </button>
            </div>
        </div>
    </div>
    
    <!-- Alert Notification -->
    <div id="alertModal" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, var(--primary-yellow), var(--accent-orange)); color: var(--primary-black); padding: 15px 25px; border-radius: var(--radius-lg); box-shadow: var(--shadow-xl); z-index: 1100; display: none; align-items: center; gap: 12px; max-width: 90%; font-weight: 700; font-size: 14px; animation: slideInDown 0.4s ease-out;">
        <div style="font-size: 20px;">‚úì</div>
        <div id="alertMessage"></div>
    </div>
    
    <!-- Image Modal -->
    <div id="imageModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 1200; justify-content: center; align-items: center; animation: fadeIn 0.3s ease-out;">
        <button onclick="closeImage()" style="position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.2); color: var(--primary-white); border: none; width: 45px; height: 45px; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px);">√ó</button>
        <img id="zoomedImage" src="" alt="Zoom" style="max-width: 90%; max-height: 90%; border-radius: var(--radius-md); box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
    </div>

    <!-- Admaven Script -->
    <div id="admaven-ad-container"></div>
    <script type="text/javascript">
        (function() {
            var script = document.createElement('script');
            script.src = 'https://ads.admaven.com/server/static/ads.js';
            script.type = 'text/javascript';
            script.async = true;
            document.getElementById('admaven-ad-container').appendChild(script);
        })();
    </script>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let cart = [];
        let currentFilter = 'all';
        let deliveryMap = null;
        let currentOrderCode = '';
        let currentConfirmationCode = '';
        let currentDriverName = '';
        let currentDriverPhone = '';
        let currentDeliveryTime = '';
        let currentProductDetail = null;
        
        // Variables pour la localisation
        let userMarker = null;
        let userLocation = null;
        let isUserLocated = false;
        
        // Variables pour le syst√®me client
        let currentClient = null;
        const CLIENT_DISCOUNT = 5; // 5% de r√©duction
        
        // ADRESSE EXACTE DU MAGASIN (pour calculs internes seulement)
        const SHOP_LOCATION = [43.3275, 5.3735]; // 134 avenue de Saint-Antoine, 13015 Marseille
        const SHOP_ADDRESS = "134 avenue de Saint-Antoine, 13015 Marseille"; // Pour calculs seulement
        
        // Syst√®me de frais de livraison R√âALISTE pour √©v√©nements
        const deliveryFees = {
            // Base selon montant d'achat
            byAmount: {
                '0-20': 5,     // 5‚Ç¨ pour commandes <20‚Ç¨
                '20-50': 3,    // 3‚Ç¨ pour 20-50‚Ç¨
                '50-100': 2,   // 2‚Ç¨ pour 50-100‚Ç¨
                '100-200': 1,  // 1‚Ç¨ pour 100-200‚Ç¨
                '200+': 0      // Gratuit >200‚Ç¨
            },
            
            // Suppl√®ments selon distance (en km)
            byDistance: {
                '0-2': 0,     // Tr√®s proche
                '2-5': 2,     // Proche
                '5-10': 4,    // Moyen
                '10+': 6      // Loin
            },
            
            // Suppl√®ments horaires (nuit)
            byTime: {
                'day': 0,     // 6h-22h
                'evening': 2, // 22h-00h
                'night': 4    // 00h-6h
            },
            
            // Suppl√©m√©nt pour √©v√©nements
            byEvent: {
                'none': 0,
                'anniversaire_enfant': 10,
                'anniversaire_ado': 15,
                'anniversaire_adultes': 20,
                'soiree_entreprise': 25,
                'mariage': 50,
                'soiree_privee': 30,
                'baby_shower': 15,
                'evenement_pro': 35
            }
        };
        
        // Stories Snapchat-style
        const shopStories = [
            {
                id: 1,
                type: 'video',
                content: 'https://assets.mixkit.co/videos/preview/mixkit-night-drive-through-a-city-41554-large.mp4',
                title: 'üéâ ORGANISATION √âV√âNEMENTS',
                description: 'Soir√©es priv√©es, anniversaires, √©v√©nements pros sur Marseille',
                duration: 12
            },
            {
                id: 2,
                type: 'image',
                content: 'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80',
                title: 'üéÇ ANNIVERSAIRE ENFANT',
                description: 'Organisation compl√®te avec animations, jeux et d√©coration',
                duration: 10
            },
            {
                id: 3,
                type: 'image',
                content: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80',
                title: 'üíº √âV√âNEMENTS ENTREPRISE',
                description: 'Catering professionnel pour vos r√©unions et soir√©es d\'entreprise',
                duration: 10
            },
            {
                id: 4,
                type: 'video',
                content: 'https://assets.mixkit.co/videos/preview/mixkit-wedding-couple-in-love-41553-large.mp4',
                title: 'üíç ORGANISATION MARIAGE',
                description: 'Service complet pour votre jour sp√©cial',
                duration: 15
            },
            {
                id: 5,
                type: 'image',
                content: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80',
                title: 'üõí PRODUITS PREMIUM',
                description: 'Boissons √©nergisantes, accessoires, kits soir√©e et plus',
                duration: 10
            }
        ];
        
        let currentStoryIndex = 0;
        let storyTimer = null;

        // Tous les produits - √âV√âNEMENTS EN PREMIER
        let products = [
            // ==================== CAT√âGORIE √âV√âNEMENTS ====================
            {
                id: 1000,
                name: "üéÇ Anniversaire Enfant (5-12 ans)",
                price: 150.00,
                image: "https://images.unsplash.com/photo-1530103862676-de8c9debad1d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Pack complet anniversaire enfant avec animations, jeux, d√©coration, g√¢teau, bonbons et boissons",
                category: "evenements",
                available: true,
                specs: [
                    "‚úÖ Pour 10 enfants maximum",
                    "‚úÖ Animations incluses (2h)",
                    "‚úÖ D√©coration sur th√®me",
                    "‚úÖ G√¢teau personnalis√©",
                    "‚úÖ Boissons et bonbons",
                    "‚úÖ Service de 3h",
                    "‚úÖ Photos souvenirs"
                ],
                size: "Pack 10 personnes",
                isPopular: false,
                pricing: {
                    base: 150,
                    extraPerPerson: 10,
                    basePersons: 10
                }
            },
            {
                id: 1001,
                name: "üéÆ Anniversaire Ado (13-17 ans)",
                price: 250.00,
                image: "https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Soir√©e gaming ou musique, snacks premium, boissons √©nergisantes, d√©coration moderne",
                category: "evenements",
                available: true,
                specs: [
                    "‚úÖ Pour 15 ados maximum",
                    "‚úÖ Setup gaming ou musique",
                    "‚úÖ Snacks premium",
                    "‚úÖ Boissons √©nergisantes",
                    "‚úÖ D√©coration moderne",
                    "‚úÖ Service de 4h",
                    "‚úÖ S√©curit√© incluse"
                ],
                size: "Pack 15 personnes",
                isPopular: false,
                pricing: {
                    base: 250,
                    extraPerPerson: 15,
                    basePersons: 15
                }
            },
            {
                id: 1002,
                name: "ü•≥ Anniversaire Adultes",
                price: 350.00,
                image: "https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Soir√©e cocktail, buffet premium, musique, d√©coration √©l√©gante, service professionnel",
                category: "evenements",
                available: true,
                specs: [
                    "‚úÖ Pour 20 adultes maximum",
                    "‚úÖ Cocktail d'accueil",
                    "‚úÖ Buffet premium",
                    "‚úÖ Playlist personnalis√©e",
                    "‚úÖ D√©coration √©l√©gante",
                    "‚úÖ Service de 5h",
                    "‚úÖ Barman professionnel"
                ],
                size: "Pack 20 personnes",
                isPopular: false,
                pricing: {
                    base: 350,
                    extraPerPerson: 15,
                    basePersons: 20
                }
            },
            {
                id: 1003,
                name: "üíº Soir√©e Entreprise",
                price: 500.00,
                image: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "√âv√©nement professionnel avec catering haut de gamme, service traiteur, installation compl√®te",
                category: "evenements",
                available: true,
                specs: [
                    "‚úÖ Jusqu'√† 30 personnes",
                    "‚úÖ Catering professionnel",
                    "‚úÖ Service traiteur",
                    "‚úÖ Installation compl√®te",
                    "‚úÖ Nettoyage inclus",
                    "‚úÖ Personnel d√©di√©",
                    "‚úÖ Mat√©riel fourni"
                ],
                size: "Pack 30 personnes",
                isPopular: false,
                pricing: {
                    base: 500,
                    extraPerPerson: 20,
                    basePersons: 30
                }
            },
            {
                id: 1004,
                name: "üíç Organisation Mariage",
                price: 1200.00,
                image: "https://images.unsplash.com/photo-1465495976277-4387d4b0e4a6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Service complet mariage : d√©coration, catering, animation, coordination, logistique",
                category: "evenements",
                available: true,
                specs: [
                    "‚úÖ Coordination compl√®te",
                    "‚úÖ D√©coration sur mesure",
                    "‚úÖ Catering mariage",
                    "‚úÖ Animation musicale",
                    "‚úÖ Photographie option",
                    "‚úÖ Service 8h minimum",
                    "‚úÖ Gestion logistique"
                ],
                size: "Service complet",
                isPopular: false,
                pricing: {
                    base: 1200,
                    extraPerPerson: 50,
                    basePersons: 50
                }
            },
            {
                id: 1005,
                name: "üéâ Soir√©e Priv√©e",
                price: 400.00,
                image: "https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Organisation soir√©e priv√©e √† domicile avec bar mobile, snacks, musique et ambiance",
                category: "evenements",
                available: true,
                specs: [
                    "‚úÖ Jusqu'√† 25 personnes",
                    "‚úÖ Bar mobile",
                    "‚úÖ Snacks vari√©s",
                    "‚úÖ Playlist personnalis√©e",
                    "‚úÖ D√©coration ambiance",
                    "‚úÖ Service de 6h",
                    "‚úÖ Gestion compl√®te"
                ],
                size: "Pack 25 personnes",
                isPopular: false,
                pricing: {
                    base: 400,
                    extraPerPerson: 15,
                    basePersons: 25
                }
            },
            {
                id: 1006,
                name: "üë∂ Baby Shower",
                price: 200.00,
                image: "https://images.unsplash.com/photo-1553452118-621e1f860f43?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Organisation baby shower avec d√©coration th√©matique, jeux, buffet l√©ger et surprises",
                category: "evenements",
                available: true,
                specs: [
                    "‚úÖ Pour 15 personnes",
                    "‚úÖ D√©coration th√©matique",
                    "‚úÖ Jeux et animations",
                    "‚úÖ Buffet l√©ger",
                    "‚úÖ G√¢teau personnalis√©",
                    "‚úÖ Service de 4h",
                    "‚úÖ Photos souvenirs"
                ],
                size: "Pack 15 personnes",
                isPopular: false,
                pricing: {
                    base: 200,
                    extraPerPerson: 10,
                    basePersons: 15
                }
            },
            {
                id: 1007,
                name: "üè¢ √âv√©nement Professionnel",
                price: 800.00,
                image: "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Organisation √©v√©nements pros : lancement produit, conf√©rence, s√©minaire avec service premium",
                category: "evenements",
                available: true,
                specs: [
                    "‚úÖ Jusqu'√† 50 personnes",
                    "‚úÖ Installation technique",
                    "‚úÖ Catering professionnel",
                    "‚úÖ Mat√©riel audiovisuel",
                    "‚úÖ Accueil personnalis√©",
                    "‚úÖ Service journ√©e compl√®te",
                    "‚úÖ Support technique"
                ],
                size: "Pack 50 personnes",
                isPopular: false,
                pricing: {
                    base: 800,
                    extraPerPerson: 25,
                    basePersons: 50
                }
            },
            
            // ==================== CAT√âGORIE ACCESSOIRES (POPULAIRES) ====================
            {
                id: 1,
                name: "Creme Deluxe",
                price: 25.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/bc49a018-064b-af44-b264-1f821d3f40e0.jpg",
                description: "Creme premium pour soir√©e, texture l√©g√®re, parfum discret, qualit√© sup√©rieure",
                category: "accessoires",
                available: true,
                specs: [
                    "‚úÖ Qualit√© premium",
                    "‚úÖ Texture l√©g√®re",
                    "‚úÖ Parfum discret",
                    "‚úÖ Longue dur√©e",
                    "‚úÖ Sans r√©sidus",
                    "‚úÖ Fabriqu√© en UE"
                ],
                size: "50ml",
                isPopular: true
            },
            {
                id: 2,
                name: "Fast Gaz",
                price: 20.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/d6ff08ad-78f0-2424-b67f-1a9f23db736c.jpeg",
                description: "Gaz rapide de qualit√© professionnelle, allumage instantan√©, dur√©e prolong√©e",
                category: "accessoires",
                available: true,
                specs: [
                    "‚úÖ Allumage instantan√©",
                    "‚úÖ Dur√©e prolong√©e",
                    "‚úÖ Qualit√© pro",
                    "‚úÖ S√©curit√© maximale",
                    "‚úÖ Sans odeur",
                    "‚úÖ Garantie qualit√©"
                ],
                size: "250ml",
                isPopular: true
            },
            {
                id: 9,
                name: "OCB Slim Noir",
                price: 25.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/d24ccf63-fd85-0b81-e6a0-a401cfb11d52.jpeg",
                description: "Papier √† rouler premium noir, ultra fin, br√ªlure lente et r√©guli√®re",
                category: "accessoires",
                available: true,
                specs: [
                    "‚úÖ Papier ultra fin",
                    "‚úÖ Br√ªlure lente",
                    "‚úÖ Qualit√© premium",
                    "‚úÖ Colle naturelle",
                    "‚úÖ 50 feuilles",
                    "‚úÖ Made in France"
                ],
                size: "Paquet de 50",
                isPopular: true
            },
            {
                id: 10,
                name: "OCB Marron",
                price: 25.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/cce76e99-720f-a078-7a66-76e9c737abd3.jpeg",
                description: "Papier √† rouler naturel marron, sans chlore, √©cologique, br√ªlure parfaite",
                category: "accessoires",
                available: true,
                specs: [
                    "‚úÖ 100% naturel",
                    "‚úÖ Sans chlore",
                    "‚úÖ √âcologique",
                    "‚úÖ Br√ªlure parfaite",
                    "‚úÖ 50 feuilles",
                    "‚úÖ Qualit√© sup√©rieure"
                ],
                size: "Paquet de 50",
                isPopular: true
            },
            {
                id: 12,
                name: "Chargeur Rapide",
                price: 12.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/1dda42ab-34ae-13a0-11ce-f5dcf16750a4.jpeg",
                description: "Chargeur allume-cigarette USB, recharge rapide, compatible voiture et prise murale",
                category: "accessoires",
                available: true,
                specs: [
                    "‚úÖ Charge rapide",
                    "‚úÖ USB compatible",
                    "‚úÖ Voiture/maison",
                    "‚úÖ S√©curit√© int√©gr√©e",
                    "‚úÖ Longue dur√©e",
                    "‚úÖ Garantie 1 an"
                ],
                size: "Standard",
                isPopular: false
            },
            {
                id: 13,
                name: "Nike TN",
                price: 80.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/2c645765-5df4-27c4-c8d5-798f09b5da45.jpeg",
                description: "Sneakers Nike TN authentiques, confort maximal, style urbain, plusieurs coloris disponibles",
                category: "accessoires",
                available: true,
                specs: [
                    "‚úÖ Authentique Nike",
                    "‚úÖ Confort maximal",
                    "‚úÖ Style urbain",
                    "‚úÖ Plusieurs coloris",
                    "‚úÖ Toutes pointures",
                    "‚úÖ Bo√Æte originale"
                ],
                size: "36-46",
                isPopular: true
            },
            {
                id: 14,
                name: "Casque Bluetooth",
                price: 30.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/e0285ed8-8ed9-f98a-34dc-f69c58a2478f.jpeg",
                description: "√âcouteurs sans fil Bluetooth, autonomie 8h, qualit√© son HD, √©tanches √† la sueur",
                category: "accessoires",
                available: true,
                specs: [
                    "‚úÖ Sans fil Bluetooth",
                    "‚úÖ Autonomie 8h",
                    "‚úÖ Qualit√© HD",
                    "‚úÖ √âtanche sueur",
                    "‚úÖ Micro int√©gr√©",
                    "‚úÖ Charge rapide"
                ],
                size: "Universal",
                isPopular: true
            },
            
            // ==================== CAT√âGORIE REPAS ====================
            {
                id: 200,
                name: "Menu d'Affaires Premium",
                price: 25.00,
                image: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Menu complet r√©unions d'affaires : entr√©e, plat, dessert, boisson chaude",
                category: "repas",
                available: true,
                specs: [
                    "‚úÖ Entr√©e au choix",
                    "‚úÖ Plat principal",
                    "‚úÖ Dessert maison",
                    "‚úÖ Boisson chaude",
                    "‚úÖ Livraison chaude",
                    "‚úÖ Emballage premium"
                ],
                size: "Portion compl√®te",
                isPopular: false
            },
            
            // ==================== CAT√âGORIE CATERING ====================
            {
                id: 300,
                name: "Catering Mariage",
                price: 500.00,
                image: "https://images.unsplash.com/photo-1465495976277-4387d4b0e4a6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                description: "Service catering mariage avec buffet chaud et froid, service traiteur, installation",
                category: "catering",
                available: true,
                specs: [
                    "‚úÖ Buffet chaud/froid",
                    "‚úÖ Service traiteur",
                    "‚úÖ Installation compl√®te",
                    "‚úÖ Personnel service",
                    "‚úÖ Nettoyage inclus",
                    "‚úÖ Service 5h minimum"
                ],
                size: "Pour 30 personnes",
                isPopular: false
            },
            
            // ==================== CAT√âGORIE BOISSONS ====================
            {
                id: 3,
                name: "Canette de Coca",
                price: 2.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/6a1f1093-3c42-4461-4910-e78105e654f3.jpeg",
                description: "Canette Coca-Cola 33cl, rafra√Æchissement classique, parfait pour les √©v√©nements",
                category: "boissons",
                available: true,
                specs: [
                    "‚úÖ 33cl",
                    "‚úÖ Rafra√Æchissant",
                    "‚úÖ Parfait √©v√©nements",
                    "‚úÖ Emballage individuel",
                    "‚úÖ Frais garanti",
                    "‚úÖ Lot disponible"
                ],
                size: "33cl",
                isPopular: false
            },
            
            // ==================== CAT√âGORIE ALCOOLS ====================
            {
                id: 8,
                name: "Vodka Premium (70cl)",
                price: 19.00,
                image: "https://mcusercontent.com/ecbcd3e0a3ef2c00dbcaefee8/images/f8d0504d-2c8a-189b-08f5-3b0f48964823.jpeg",
                description: "Vodka premium 70cl, qualit√© sup√©rieure, parfaite pour cocktails et √©v√©nements",
                category: "alcools",
                available: true,
                specs: [
                    "‚úÖ 70cl",
                    "‚úÖ Qualit√© premium",
                    "‚úÖ Parfaite cocktails",
                    "‚úÖ Bouteille originale",
                    "‚úÖ Service √©v√©nements",
                    "‚úÖ Livraison s√©curis√©e"
                ],
                size: "70cl",
                isPopular: false
            }
        ];

        // ==================== INITIALISATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initDeliveryMap();
            renderProducts();
            initEventListeners();
            loadCartFromStorage();
            initFilters();
            checkActiveOrder();
            initPayPal();
            checkClientStatus();
            initAccountButton();
        });

        // ==================== SYST√àME DE LOCALISATION ====================
        function locateUser() {
            const button = document.getElementById('locateMeButton');
            const distanceDisplay = document.getElementById('distanceDisplay');
            const distanceText = document.getElementById('distanceText');
            
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Localisation...';
            
            distanceDisplay.style.display = 'block';
            distanceText.textContent = 'Localisation en cours...';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;
                        userLocation = [userLat, userLng];
                        
                        // Calculer la distance
                        const distance = calculateDistance(SHOP_LOCATION[0], SHOP_LOCATION[1], userLat, userLng);
                        const zone = getZoneByDistance(distance);
                        
                        // Afficher la distance
                        distanceText.innerHTML = `<strong>${distance.toFixed(1)} km</strong> du magasin ‚Ä¢ ${zone}`;
                        
                        // Ajouter un marqueur sur la carte
                        if (userMarker) {
                            deliveryMap.removeLayer(userMarker);
                        }
                        
                        userMarker = L.marker([userLat, userLng], {
                            icon: L.divIcon({
                                html: '<div style="background: #2196F3; width: 40px; height: 40px; border-radius: 50%; border: 3px solid white; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(33, 150, 243, 0.7);"><i class="fas fa-user" style="color: white; font-size: 18px;"></i></div>',
                                iconSize: [40, 40],
                                iconAnchor: [20, 40],
                                className: 'user-marker'
                            })
                        }).addTo(deliveryMap);
                        
                        // Centrer la carte sur l'utilisateur
                        deliveryMap.setView([userLat, userLng], 13);
                        
                        // Tracer une ligne entre le magasin et l'utilisateur
                        L.polyline([SHOP_LOCATION, [userLat, userLng]], {
                            color: '#2196F3',
                            weight: 3,
                            opacity: 0.7,
                            dashArray: '10, 10'
                        }).addTo(deliveryMap);
                        
                        // Mettre √† jour le bouton
                        button.innerHTML = '<i class="fas fa-check"></i> Localis√©';
                        button.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
                        isUserLocated = true;
                        
                        // Sauvegarder la localisation
                        localStorage.setItem('hds_shop_user_location', JSON.stringify({
                            lat: userLat,
                            lng: userLng,
                            distance: distance,
                            zone: zone,
                            timestamp: Date.now()
                        }));
                        
                        showAlert('üìç Localisation r√©ussie ! Distance calcul√©e.');
                    },
                    function(error) {
                        console.error('Erreur de g√©olocalisation:', error);
                        
                        // Simulation pour le d√©veloppement
                        simulateLocation();
                        
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-location-dot"></i> Me localiser';
                        distanceText.textContent = 'Erreur de localisation. Simulation activ√©e.';
                        
                        showAlert('‚ö†Ô∏è Utilisation de la simulation de localisation', 'warning');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                // G√©olocalisation non support√©e
                simulateLocation();
                
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-location-dot"></i> Me localiser';
                distanceText.textContent = 'G√©olocalisation non support√©e. Simulation activ√©e.';
                
                showAlert('‚ö†Ô∏è Simulation de localisation activ√©e', 'warning');
            }
        }
        
        function simulateLocation() {
            // Simulation de position dans Marseille
            const marseilleDistricts = [
                {name: "Vieux Port", coords: [43.2950, 5.3750]},
                {name: "La Plaine", coords: [43.2900, 5.3820]},
                {name: "Endoume", coords: [43.2850, 5.3650]},
                {name: "Pr√©fecture", coords: [43.3030, 5.3800]},
                {name: "Saint-Just", coords: [43.3150, 5.3950]}
            ];
            
            const randomDistrict = marseilleDistricts[Math.floor(Math.random() * marseilleDistricts.length)];
            userLocation = randomDistrict.coords;
            
            const distance = calculateDistance(SHOP_LOCATION[0], SHOP_LOCATION[1], randomDistrict.coords[0], randomDistrict.coords[1]);
            const zone = getZoneByDistance(distance);
            
            const distanceText = document.getElementById('distanceText');
            distanceText.innerHTML = `<strong>${distance.toFixed(1)} km</strong> du magasin ‚Ä¢ ${zone} ‚Ä¢ ${randomDistrict.name}`;
            
            // Ajouter un marqueur sur la carte
            if (userMarker) {
                deliveryMap.removeLayer(userMarker);
            }
            
            userMarker = L.marker(randomDistrict.coords, {
                icon: L.divIcon({
                    html: '<div style="background: #2196F3; width: 40px; height: 40px; border-radius: 50%; border: 3px solid white; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(33, 150, 243, 0.7);"><i class="fas fa-user" style="color: white; font-size: 18px;"></i></div>',
                    iconSize: [40, 40],
                    iconAnchor: [20, 40],
                    className: 'user-marker'
                })
            }).addTo(deliveryMap);
            
            // Tracer une ligne entre le magasin et l'utilisateur
            L.polyline([SHOP_LOCATION, randomDistrict.coords], {
                color: '#2196F3',
                weight: 3,
                opacity: 0.7,
                dashArray: '10, 10'
            }).addTo(deliveryMap);
            
            const button = document.getElementById('locateMeButton');
            button.innerHTML = '<i class="fas fa-check"></i> Localis√© (simulation)';
            button.style.background = 'linear-gradient(135deg, #2196F3, #1976D2)';
            isUserLocated = true;
        }
        
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Rayon de la Terre en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        function getZoneByDistance(distanceKm) {
            if (distanceKm <= 2) return "Zone Centre";
            else if (distanceKm <= 5) return "Zone Proche";
            else if (distanceKm <= 10) return "Zone Moyenne";
            else return "Zone √âloign√©e";
        }
        
        // ==================== SYST√àME CLIENT ====================
        function initAccountButton() {
            const savedClient = localStorage.getItem('hds_shop_client');
            if (savedClient) {
                currentClient = JSON.parse(savedClient);
                updateAccountButton(true);
            } else {
                updateAccountButton(false);
            }
        }
        
        function updateAccountButton(isConnected) {
            const button = document.getElementById('accountButton');
            if (isConnected) {
                button.classList.remove('disconnected');
                button.classList.add('connected');
                button.innerHTML = '<i class="fas fa-user-check"></i>';
            } else {
                button.classList.remove('connected');
                button.classList.add('disconnected');
                button.innerHTML = '<i class="fas fa-user"></i>';
            }
        }
        
        function openAccountModal() {
            const savedClient = localStorage.getItem('hds_shop_client');
            
            if (savedClient) {
                currentClient = JSON.parse(savedClient);
                showClientSection();
            } else {
                showLoginSection();
            }
            
            document.getElementById('accountModalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeAccountModal() {
            document.getElementById('accountModalOverlay').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function showLoginSection() {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('registerSection').style.display = 'none';
            document.getElementById('clientSection').style.display = 'none';
        }
        
        function showRegistration() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('registerSection').style.display = 'block';
            document.getElementById('clientSection').style.display = 'none';
        }
        
        function showClientSection() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('registerSection').style.display = 'none';
            document.getElementById('clientSection').style.display = 'block';
            
            // Mettre √† jour les infos client
            document.getElementById('clientName').textContent = currentClient.name;
            document.getElementById('clientPhone').textContent = currentClient.phone;
            document.getElementById('clientCodeDisplay').textContent = currentClient.code;
            
            // Charger l'historique des commandes
            loadOrderHistory();
        }
        
        function loginClient() {
            const code = document.getElementById('clientCode').value;
            
            if (!code || code.length !== 4 || isNaN(code)) {
                showAlert('‚ùå Code invalide. Entrez 4 chiffres.', 'error');
                return;
            }
            
            const savedClient = localStorage.getItem('hds_shop_client');
            
            if (savedClient) {
                const client = JSON.parse(savedClient);
                if (client.code === code) {
                    currentClient = client;
                    updateAccountButton(true);
                    showClientSection();
                    showAlert(`‚úÖ Bienvenue ${client.name} ! R√©duction de ${CLIENT_DISCOUNT}% activ√©e.`);
                } else {
                    showAlert('‚ùå Code incorrect.', 'error');
                }
            } else {
                showAlert('‚ùå Aucun compte trouv√©. Inscrivez-vous.', 'error');
            }
        }
        
        function registerClient() {
            const name = document.getElementById('registerName').value;
            const phone = document.getElementById('registerPhone').value;
            const code = document.getElementById('registerCode').value;
            
            if (!name || !phone || !code) {
                showAlert('‚ùå Tous les champs sont requis.', 'error');
                return;
            }
            
            if (code.length !== 4 || isNaN(code)) {
                showAlert('‚ùå Le code doit √™tre compos√© de 4 chiffres.', 'error');
                return;
            }
            
            const client = {
                name: name,
                phone: phone,
                code: code,
                joined: new Date().toISOString(),
                orders: []
            };
            
            localStorage.setItem('hds_shop_client', JSON.stringify(client));
            currentClient = client;
            
            updateAccountButton(true);
            showClientSection();
            showAlert(`‚úÖ Compte cr√©√© ! Bienvenue ${name}. Profitez de -${CLIENT_DISCOUNT}% sur toutes vos commandes.`);
        }
        
        function logoutClient() {
            currentClient = null;
            localStorage.removeItem('hds_shop_client');
            
            updateAccountButton(false);
            showLoginSection();
            showAlert('üëã D√©connexion r√©ussie.');
        }
        
        function loadOrderHistory() {
            const orderHistory = document.getElementById('orderHistory');
            
            if (!currentClient || !currentClient.orders || currentClient.orders.length === 0) {
                orderHistory.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray-500);">
                        <div style="font-size: 40px; margin-bottom: 10px;">üì¶</div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Aucune commande</div>
                        <div style="font-size: 13px;">Votre historique de commandes appara√Ætra ici</div>
                    </div>
                `;
                return;
            }
            
            let historyHTML = '';
            currentClient.orders.forEach((order, index) => {
                historyHTML += `
                    <div class="history-item">
                        <div class="history-date">${new Date(order.date).toLocaleDateString('fr-FR')} ‚Ä¢ Commande #${order.code}</div>
                        <div style="font-size: 14px; color: var(--gray-300); margin-bottom: 5px;">${order.items} articles</div>
                        <div class="history-total">${order.total}</div>
                    </div>
                `;
            });
            
            orderHistory.innerHTML = historyHTML;
        }
        
        function addOrderToHistory(orderDetails) {
            if (!currentClient) return;
            
            if (!currentClient.orders) {
                currentClient.orders = [];
            }
            
            currentClient.orders.unshift({
                date: new Date().toISOString(),
                code: orderDetails.code || 'CMD-' + Math.floor(10000 + Math.random() * 90000),
                items: orderDetails.items || cart.reduce((sum, item) => sum + item.quantity, 0),
                total: orderDetails.total || '0‚Ç¨'
            });
            
            // Garder seulement les 10 derni√®res commandes
            if (currentClient.orders.length > 10) {
                currentClient.orders = currentClient.orders.slice(0, 10);
            }
            
            localStorage.setItem('hds_shop_client', JSON.stringify(currentClient));
        }
        
        // ==================== PAYPAL INTEGRATION ====================
        function initPayPal() {
            // √âcouter les changements de m√©thode de paiement
            document.querySelectorAll('input[name="paiement"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'Carte Bancaire' && this.checked) {
                        document.getElementById('paypal-button-container').style.display = 'block';
                        renderPayPalButton();
                    } else {
                        document.getElementById('paypal-button-container').style.display = 'none';
                    }
                });
            });
        }
        
        function renderPayPalButton() {
            // Nettoyer le conteneur
            document.getElementById('paypal-button-container').innerHTML = '';
            
            // Calculer le total
            let subtotal = calculateSubtotal();
            let discount = calculateClientDiscount(subtotal);
            let total = subtotal - discount;
            
            // Dans un vrai site, tu utiliserais ton vrai client-id PayPal
            // Pour l'instant, simulation
            document.getElementById('paypal-button-container').innerHTML = `
                <div style="background: rgba(255,255,255,0.05); border-radius: var(--radius-md); padding: 15px; text-align: center;">
                    <div style="font-size: 14px; color: var(--gray-300); margin-bottom: 10px;">
                        <i class="fab fa-paypal" style="color: #003087; font-size: 20px; margin-right: 8px;"></i>
                        Paiement PayPal s√©curis√©
                    </div>
                    <div style="font-size: 12px; color: var(--gray-400); margin-bottom: 10px;">
                        Total √† payer: <span style="color: var(--primary-yellow); font-weight: 700;">${total.toFixed(2)}‚Ç¨</span>
                    </div>
                    <button class="checkout-button" onclick="processPayPalPayment()" style="background: linear-gradient(135deg, #003087, #009CDE);">
                        <i class="fab fa-paypal"></i>
                        Payer avec PayPal
                    </button>
                    <div style="font-size: 10px; color: var(--gray-500); margin-top: 10px;">
                        Paiement 100% s√©curis√© ‚Ä¢ Aucune information bancaire stock√©e
                    </div>
                </div>
            `;
        }
        
        function processPayPalPayment() {
            // Simulation de paiement PayPal r√©ussi
            showAlert('‚úÖ Paiement PayPal accept√© !', 'success');
            
            // Cacher le bouton PayPal
            document.getElementById('paypal-button-container').style.display = 'none';
            
            // Cocher esp√®ces pour continuer le processus normal
            document.getElementById('cash').checked = true;
            
            // Soumettre la commande
            setTimeout(() => {
                submitOrder();
            }, 1500);
        }
        
        // ==================== TABLEAU DE PRIX DYNAMIQUE ====================
        function updateEventPricing() {
            const eventType = document.querySelector('select[name="type_evenement"]').value;
            const pricingTable = document.getElementById('eventPricingTable');
            
            if (eventType) {
                pricingTable.style.display = 'block';
                calculateEventPrice();
            } else {
                pricingTable.style.display = 'none';
            }
        }
        
        function calculateEventPrice() {
            const personCount = parseInt(document.getElementById('personCount').value) || 10;
            let basePrice = 150;
            let extraPerPerson = 10;
            let basePersons = 10;
            
            // Ajuster selon le type d'√©v√©nement
            const eventType = document.querySelector('select[name="type_evenement"]').value;
            switch(eventType) {
                case 'anniversaire_enfant':
                    basePrice = 150;
                    extraPerPerson = 10;
                    basePersons = 10;
                    break;
                case 'anniversaire_ado':
                    basePrice = 250;
                    extraPerPerson = 15;
                    basePersons = 15;
                    break;
                case 'anniversaire_adultes':
                    basePrice = 350;
                    extraPerPerson = 15;
                    basePersons = 20;
                    break;
                case 'soiree_entreprise':
                    basePrice = 500;
                    extraPerPerson = 20;
                    basePersons = 30;
                    break;
                case 'mariage':
                    basePrice = 1200;
                    extraPerPerson = 50;
                    basePersons = 50;
                    break;
                case 'soiree_privee':
                    basePrice = 400;
                    extraPerPerson = 15;
                    basePersons = 25;
                    break;
                case 'baby_shower':
                    basePrice = 200;
                    extraPerPerson = 10;
                    basePersons = 15;
                    break;
                case 'evenement_pro':
                    basePrice = 800;
                    extraPerPerson = 25;
                    basePersons = 50;
                    break;
            }
            
            let totalPrice = basePrice;
            if (personCount > basePersons) {
                totalPrice += (personCount - basePersons) * extraPerPerson;
            }
            
            document.getElementById('estimatedPrice').textContent = totalPrice + '‚Ç¨';
            
            // Mettre √† jour le prix dans le panier si un √©v√©nement est s√©lectionn√©
            updateEventInCart(eventType, personCount, totalPrice);
        }
        
        function updateEventInCart(eventType, personCount, totalPrice) {
            // Chercher si un √©v√©nement est d√©j√† dans le panier
            const eventIndex = cart.findIndex(item => 
                item.category === 'evenements' && 
                item.name.toLowerCase().includes(eventType.replace('_', ' '))
            );
            
            if (eventIndex !== -1) {
                // Mettre √† jour l'√©v√©nement existant
                cart[eventIndex].price = totalPrice;
                cart[eventIndex].quantity = 1;
                cart[eventIndex].personCount = personCount;
                updateCart();
            }
        }
        
        function calculateDetailPrice() {
            if (!currentProductDetail || currentProductDetail.category !== 'evenements') return;
            
            const personCount = parseInt(document.getElementById('detailPersonCount').value) || currentProductDetail.pricing.basePersons;
            const basePrice = currentProductDetail.pricing.base;
            const extraPerPerson = currentProductDetail.pricing.extraPerPerson;
            const basePersons = currentProductDetail.pricing.basePersons;
            
            let totalPrice = basePrice;
            if (personCount > basePersons) {
                totalPrice += (personCount - basePersons) * extraPerPerson;
            }
            
            document.getElementById('detailEstimatedPrice').textContent = totalPrice + '‚Ç¨';
            document.getElementById('priceBase').textContent = basePrice + '‚Ç¨';
            document.getElementById('priceExtra').textContent = extraPerPerson + '‚Ç¨/pers';
        }
        
        // ==================== FONCTIONS CARTE ====================
        function initDeliveryMap() {
            try {
                if (!document.getElementById('deliveryMap')) return;
                
                if (deliveryMap) deliveryMap.remove();
                
                // Vue plus large sur Marseille
                const marseille = [43.2965, 5.3698];
                deliveryMap = L.map('deliveryMap').setView(marseille, 11);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap',
                    maxZoom: 18
                }).addTo(deliveryMap);
                
                // Cr√©er le marqueur avec STORIES (Snapchat style)
                const storyMarker = L.divIcon({
                    html: `
                        <div class="story-marker" onclick="openStories()" title="Cliquez pour voir les stories">
                        </div>
                    `,
                    iconSize: [50, 50],
                    iconAnchor: [25, 50],
                    className: 'story-marker-container'
                });
                
                // Ajouter le marqueur avec stories
                L.marker(SHOP_LOCATION, { icon: storyMarker })
                    .addTo(deliveryMap)
                    .bindPopup(`
                        <b>H.D.S SHOP √âv√©nements</b><br>
                        <small>üé• <a href="#" onclick="openStories(); return false;">Voir les stories (5)</a></small>
                    `)
                    .openPopup();
                
                // Ajouter les zones de livraison
                addDeliveryZones();
                
                // Charger la localisation pr√©c√©dente si elle existe
                const savedLocation = localStorage.getItem('hds_shop_user_location');
                if (savedLocation) {
                    const location = JSON.parse(savedLocation);
                    if (Date.now() - location.timestamp < 24 * 60 * 60 * 1000) { // 24 heures
                        userLocation = [location.lat, location.lng];
                        isUserLocated = true;
                        
                        // Ajouter le marqueur utilisateur
                        userMarker = L.marker([location.lat, location.lng], {
                            icon: L.divIcon({
                                html: '<div style="background: #2196F3; width: 40px; height: 40px; border-radius: 50%; border: 3px solid white; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(33, 150, 243, 0.7);"><i class="fas fa-user" style="color: white; font-size: 18px;"></i></div>',
                                iconSize: [40, 40],
                                iconAnchor: [20, 40],
                                className: 'user-marker'
                            })
                        }).addTo(deliveryMap);
                        
                        // Tracer une ligne
                        L.polyline([SHOP_LOCATION, [location.lat, location.lng]], {
                            color: '#2196F3',
                            weight: 3,
                            opacity: 0.7,
                            dashArray: '10, 10'
                        }).addTo(deliveryMap);
                        
                        // Mettre √† jour l'affichage
                        document.getElementById('distanceDisplay').style.display = 'block';
                        document.getElementById('distanceText').innerHTML = `<strong>${location.distance.toFixed(1)} km</strong> du magasin ‚Ä¢ ${location.zone}`;
                        
                        const button = document.getElementById('locateMeButton');
                        button.innerHTML = '<i class="fas fa-check"></i> Localis√©';
                        button.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
                    }
                }
                
                setTimeout(() => {
                    if (deliveryMap) deliveryMap.invalidateSize();
                }, 100);
                
            } catch (error) {
                console.error('Erreur carte:', error);
            }
        }
        
        function addDeliveryZones() {
            // Zone 1: Centre-ville (0-2km) - Gratuite √† partir de 200‚Ç¨
            L.circle([43.2965, 5.3698], {
                color: '#4CAF50',
                fillColor: '#4CAF50',
                fillOpacity: 0.2,
                radius: 2000
            }).addTo(deliveryMap).bindPopup('üü¢ Zone Centre<br>0-2km ‚Ä¢ Frais selon montant');
            
            // Zone 2: Proche banlieue (2-5km)
            L.circle([43.2800, 5.3800], {
                color: '#FF9800',
                fillColor: '#FF9800',
                fillOpacity: 0.2,
                radius: 3000
            }).addTo(deliveryMap).bindPopup('üü† Zone Proche<br>2-5km ‚Ä¢ 2-3‚Ç¨ suppl√©ment');
            
            // Zone 3: Banlieue moyenne (5-10km)
            L.circle([43.3100, 5.4000], {
                color: '#9C27B0',
                fillColor: '#9C27B0',
                fillOpacity: 0.2,
                radius: 4000
            }).addTo(deliveryMap).bindPopup('üü£ Zone Moyenne<br>5-10km ‚Ä¢ 4-5‚Ç¨ suppl√©ment');
            
            // Zone 4: Loin (10+ km)
            L.circle([43.3500, 5.4500], {
                color: '#2196F3',
                fillColor: '#2196F3',
                fillOpacity: 0.2,
                radius: 5000
            }).addTo(deliveryMap).bindPopup('üîµ Zone √âloign√©e<br>10+ km ‚Ä¢ 6-8‚Ç¨ suppl√©ment');
        }
        
        // ==================== CALCUL DE DISTANCE R√âELLE ====================
        function calculateRealDistance(userAddress) {
            // Si l'utilisateur s'est localis√©, utiliser ses coordonn√©es GPS
            if (userLocation) {
                const distance = calculateDistance(SHOP_LOCATION[0], SHOP_LOCATION[1], userLocation[0], userLocation[1]);
                return {
                    distance: distance,
                    coords: userLocation,
                    zone: getZoneByDistance(distance)
                };
            }
            
            // Sinon, estimer √† partir de l'adresse
            // Coordonn√©es approximatives de quartiers de Marseille
            const marseilleDistricts = {
                "vieux port": [43.2950, 5.3750],
                "noailles": [43.2960, 5.3820],
                "la plaine": [43.2900, 5.3820],
                "prefecture": [43.3030, 5.3800],
                "endoume": [43.2850, 5.3650],
                "pointe rouge": [43.2750, 5.3650],
                "saint just": [43.3150, 5.3950],
                "la rose": [43.3050, 5.4050],
                "saint antoine": [43.3500, 5.3800],
                "les olives": [43.3700, 5.4300],
                "la madrague": [43.2500, 5.4200]
            };
            
            // Chercher des mots-cl√©s dans l'adresse
            let userCoords = null;
            const lowerAddress = userAddress.toLowerCase();
            
            for (const [district, coords] of Object.entries(marseilleDistricts)) {
                if (lowerAddress.includes(district)) {
                    userCoords = coords;
                    break;
                }
            }
            
            // Si pas trouv√©, coordonn√©es al√©atoires dans Marseille
            if (!userCoords) {
                userCoords = [
                    43.29 + (Math.random() * 0.1),
                    5.36 + (Math.random() * 0.1)
                ];
            }
            
            // Calculer la distance en km
            const lat1 = SHOP_LOCATION[0];
            const lon1 = SHOP_LOCATION[1];
            const lat2 = userCoords[0];
            const lon2 = userCoords[1];
            
            const distance = calculateDistance(lat1, lon1, lat2, lon2);
            
            return {
                distance: distance,
                coords: userCoords,
                zone: getZoneByDistance(distance)
            };
        }
        
        // ==================== SYST√àME DE FRAIS R√âALISTE POUR √âV√âNEMENTS ====================
        function calculateRealisticDeliveryFees(subtotal, userAddress, eventType = 'none') {
            let totalFees = 0;
            let details = [];
            
            // 1. Calculer la distance r√©elle
            const distanceInfo = calculateRealDistance(userAddress);
            const distanceKm = distanceInfo.distance;
            const zone = distanceInfo.zone;
            
            details.push(`Distance: ${distanceKm.toFixed(1)}km (${zone})`);
            
            // 2. Frais selon montant d'achat
            if (subtotal < 20) {
                totalFees += deliveryFees.byAmount['0-20'];
                details.push("Commande <20‚Ç¨: 5‚Ç¨");
            } else if (subtotal < 50) {
                totalFees += deliveryFees.byAmount['20-50'];
                details.push("Commande 20-50‚Ç¨: 3‚Ç¨");
            } else if (subtotal < 100) {
                totalFees += deliveryFees.byAmount['50-100'];
                details.push("Commande 50-100‚Ç¨: 2‚Ç¨");
            } else if (subtotal < 200) {
                totalFees += deliveryFees.byAmount['100-200'];
                details.push("Commande 100-200‚Ç¨: 1‚Ç¨");
            } else {
                details.push("Gratuit √† partir de 200‚Ç¨");
            }
            
            // 3. Suppl√©ment distance
            if (distanceKm <= 2) {
                totalFees += deliveryFees.byDistance['0-2'];
            } else if (distanceKm <= 5) {
                totalFees += deliveryFees.byDistance['2-5'];
                details.push("Zone 2-5km: +2‚Ç¨");
            } else if (distanceKm <= 10) {
                totalFees += deliveryFees.byDistance['5-10'];
                details.push("Zone 5-10km: +4‚Ç¨");
            } else {
                totalFees += deliveryFees.byDistance['10+'];
                details.push("Zone >10km: +6‚Ç¨");
            }
            
            // 4. Suppl√©ment horaire (nuit)
            const now = new Date();
            const currentHour = now.getHours();
            
            if (currentHour >= 22 || currentHour < 6) {
                if (currentHour >= 22 && currentHour < 24) {
                    totalFees += deliveryFees.byTime['evening'];
                    details.push("Soir√©e (22h-00h): +2‚Ç¨");
                } else {
                    totalFees += deliveryFees.byTime['night'];
                    details.push("Nuit (00h-6h): +4‚Ç¨");
                }
            }
            
            // 5. Suppl√©ment √©v√©nement
            if (eventType !== 'none' && deliveryFees.byEvent[eventType]) {
                totalFees += deliveryFees.byEvent[eventType];
                details.push(`√âv√©nement ${eventType}: +${deliveryFees.byEvent[eventType]}‚Ç¨`);
            }
            
            // 6. Minimum pour tr√®s petites commandes
            if (subtotal < 10 && totalFees < 5) {
                totalFees = 5;
                details.push("Minimum 5‚Ç¨ pour commandes <10‚Ç¨");
            }
            
            // 7. Maximum raisonnable
            if (totalFees > 15) totalFees = 15;
            
            return {
                cost: totalFees,
                distance: distanceKm,
                zone: zone,
                details: details,
                free: subtotal >= 200 && distanceKm <= 5 && eventType === 'none'
            };
        }
        
        // ==================== STORIES SNAPCHAT STYLE ====================
        function openStories() {
            document.getElementById('storiesModalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
            currentStoryIndex = 0;
            showStory(currentStoryIndex);
        }
        
        function closeStories() {
            document.getElementById('storiesModalOverlay').classList.remove('active');
            document.body.style.overflow = 'auto';
            stopStoryTimer();
        }
        
        function showStory(index) {
            // Cacher toutes les stories
            document.querySelectorAll('.story-slide').forEach(slide => {
                slide.style.display = 'none';
            });
            
            // R√©initialiser les barres de progression
            document.querySelectorAll('.story-progress-fill').forEach(bar => {
                bar.classList.remove('active');
                bar.style.width = '0%';
            });
            
            // Afficher la story courante
            const story = shopStories[index];
            const slide = document.getElementById(`storySlide${index + 1}`);
            const progressBar = document.getElementById(`storyProgress${index + 1}`);
            
            slide.style.display = 'block';
            progressBar.classList.add('active');
            progressBar.style.animationDuration = `${story.duration}s`;
            
            // D√©marrer le timer
            stopStoryTimer();
            storyTimer = setTimeout(() => {
                nextStory();
            }, story.duration * 1000);
        }
        
        function nextStory() {
            if (currentStoryIndex < shopStories.length - 1) {
                currentStoryIndex++;
                showStory(currentStoryIndex);
            } else {
                closeStories();
            }
        }
        
        function prevStory() {
            if (currentStoryIndex > 0) {
                currentStoryIndex--;
                showStory(currentStoryIndex);
            }
        }
        
        function stopStoryTimer() {
            if (storyTimer) {
                clearTimeout(storyTimer);
                storyTimer = null;
            }
        }

        // ==================== FONCTIONS PRODUITS ====================
        function renderProducts() {
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) return;
            
            productsGrid.innerHTML = '';
            
            // Trier les produits selon le filtre
            let filteredProducts = products.filter(product => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'accessoires') return product.category === 'accessoires' && product.isPopular;
                return product.category === currentFilter;
            });
            
            // Si "Tous", mettre les √©v√©nements en premier
            if (currentFilter === 'all') {
                filteredProducts.sort((a, b) => {
                    if (a.category === 'evenements' && b.category !== 'evenements') return -1;
                    if (a.category !== 'evenements' && b.category === 'evenements') return 1;
                    if (a.category === 'accessoires' && b.category !== 'accessoires' && b.category !== 'evenements') return -1;
                    return 0;
                });
            }
            
            // Si "Populaires", trier par popularit√©
            if (currentFilter === 'accessoires') {
                filteredProducts = filteredProducts.filter(p => p.isPopular);
            }
            
            filteredProducts.forEach(product => {
                const discountedPrice = currentClient ? product.price * (1 - CLIENT_DISCOUNT / 100) : product.price;
                
                const productHTML = `
                    <div class="product-card">
                        ${product.available && product.category === 'evenements' ? 
                            `<div class="product-badge" style="background: rgba(156,39,176,0.2); color: #9C27B0; border-color: rgba(156,39,176,0.3);">üéä √âV√âNEMENT</div>` : ''}
                        ${product.available && product.category === 'accessoires' && product.isPopular ? 
                            `<div class="product-badge" style="background: rgba(255,152,0,0.2); color: #FF9800; border-color: rgba(255,152,0,0.3);">üî• POPULAIRE</div>` : ''}
                        ${!product.available ? 
                            `<div class="product-badge" style="background: rgba(255,82,82,0.2); color: #FF5252; border-color: rgba(255,82,82,0.3);">Indisponible</div>` : ''}
                        
                        <div class="product-image-container">
                            <img src="${product.image}" 
                                 alt="${product.name}" 
                                 class="product-image"
                                 onclick="showImage('${product.image}')"
                                 onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22><rect width=%22400%22 height=%22300%22 fill=%22#111%22/><text x=%22200%22 y=%22160%22 font-family=%22Inter%22 font-size=%2224%22 fill=%22%23FFD700%22 text-anchor=%22middle%22>H.D.S SHOP</text><text x=%22200%22 y=%22190%22 font-family=%22Inter%22 font-size=%2216%22 fill=%22%23FFD700%22 text-anchor=%22middle%22>${product.name}</text></svg>'">
                        </div>
                        
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">
                            ${currentClient && product.category !== 'evenements' ? 
                                `<span class="original-price">${product.price.toFixed(2)}‚Ç¨</span>
                                 <span class="discounted-price">${discountedPrice.toFixed(2)}‚Ç¨</span>
                                 <span class="client-badge">-${CLIENT_DISCOUNT}%</span>` : 
                                `${product.price.toFixed(2)}‚Ç¨`}
                        </div>
                        <div class="product-description">${product.description}</div>
                        
                        <button class="product-details-btn" onclick="openProductDetail(${product.id})">
                            <i class="fas fa-info-circle"></i> Voir d√©tails
                        </button>
                        
                        <div class="product-actions">
                            <div class="quantity-selector">
                                <button class="quantity-btn" onclick="decrementQuantity(this)">-</button>
                                <input type="number" value="1" min="1" class="quantity-input">
                                <button class="quantity-btn" onclick="incrementQuantity(this)">+</button>
                            </div>
                            <button class="buy-button" onclick="addToCartWithQuantity(${product.id}, this)" ${!product.available ? 'disabled' : ''}>
                                ${!product.available ? 'Indisponible' : 'Ajouter'}
                            </button>
                        </div>
                    </div>
                `;
                productsGrid.innerHTML += productHTML;
            });
        }
        
        function openProductDetail(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            currentProductDetail = product;
            
            document.getElementById('detailProductImage').src = product.image;
            document.getElementById('detailProductName').textContent = product.name;
            
            // Afficher le prix avec r√©duction si client
            const discountedPrice = currentClient && product.category !== 'evenements' ? 
                product.price * (1 - CLIENT_DISCOUNT / 100) : product.price;
            
            if (currentClient && product.category !== 'evenements') {
                document.getElementById('detailProductPrice').innerHTML = `
                    <span style="text-decoration: line-through; color: var(--gray-500); margin-right: 8px;">${product.price.toFixed(2)}‚Ç¨</span>
                    <span style="color: var(--primary-yellow);">${discountedPrice.toFixed(2)}‚Ç¨</span>
                    <span class="client-badge">-${CLIENT_DISCOUNT}%</span>
                `;
            } else {
                document.getElementById('detailProductPrice').textContent = product.price.toFixed(2) + '‚Ç¨';
            }
            
            document.getElementById('detailProductDescription').textContent = product.description;
            
            // Afficher les sp√©cifications
            const specsContainer = document.getElementById('detailProductSpecs');
            specsContainer.innerHTML = `
                <h4>üìã D√©tails du produit</h4>
                <ul>
                    ${product.specs ? product.specs.map(spec => `<li>${spec}</li>`).join('') : ''}
                    ${product.size ? `<li><strong>Taille/Format:</strong> ${product.size}</li>` : ''}
                    <li><strong>Cat√©gorie:</strong> ${getCategoryLabel(product.category)}</li>
                    <li><strong>Disponibilit√©:</strong> ${product.available ? '‚úÖ En stock' : '‚ùå Rupture'}</li>
                </ul>
            `;
            
            // Afficher le tableau de prix pour les √©v√©nements
            const pricingTable = document.getElementById('detailPricingTable');
            if (product.category === 'evenements' && product.pricing) {
                pricingTable.style.display = 'block';
                calculateDetailPrice();
            } else {
                pricingTable.style.display = 'none';
            }
            
            document.getElementById('detailQuantityInput').value = 1;
            document.getElementById('detailBuyButton').disabled = !product.available;
            document.getElementById('detailBuyButton').innerHTML = !product.available ? 'Indisponible' : 'Ajouter au panier';
            
            document.getElementById('productDetailModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeProductDetail() {
            document.getElementById('productDetailModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            currentProductDetail = null;
        }
        
        function detailIncrementQuantity() {
            const input = document.getElementById('detailQuantityInput');
            input.value = parseInt(input.value) + 1;
            input.style.transform = 'scale(1.1)';
            setTimeout(() => input.style.transform = 'scale(1)', 150);
        }
        
        function detailDecrementQuantity() {
            const input = document.getElementById('detailQuantityInput');
            if (parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
                input.style.transform = 'scale(0.9)';
                setTimeout(() => input.style.transform = 'scale(1)', 150);
            }
        }
        
        function addToCartFromDetail() {
            if (!currentProductDetail || !currentProductDetail.available) {
                showAlert('‚ùå Produit indisponible', 'error');
                return;
            }
            
            const quantity = parseInt(document.getElementById('detailQuantityInput').value);
            let price = currentProductDetail.price;
            
            // Appliquer la r√©duction client si applicable
            if (currentClient && currentProductDetail.category !== 'evenements') {
                price = price * (1 - CLIENT_DISCOUNT / 100);
            }
            
            // Pour les √©v√©nements, utiliser le prix calcul√©
            if (currentProductDetail.category === 'evenements') {
                const personCount = parseInt(document.getElementById('detailPersonCount').value) || currentProductDetail.pricing.basePersons;
                const basePrice = currentProductDetail.pricing.base;
                const extraPerPerson = currentProductDetail.pricing.extraPerPerson;
                const basePersons = currentProductDetail.pricing.basePersons;
                
                price = basePrice;
                if (personCount > basePersons) {
                    price += (personCount - basePersons) * extraPerPerson;
                }
            }
            
            const existingItem = cart.find(item => item.id === currentProductDetail.id);
            
            if (existingItem) {
                existingItem.quantity += quantity;
                existingItem.price = price; // Mettre √† jour le prix au cas o√π il aurait chang√©
            } else {
                cart.push({
                    id: currentProductDetail.id,
                    name: currentProductDetail.name,
                    price: price,
                    quantity: quantity,
                    category: currentProductDetail.category,
                    originalPrice: currentProductDetail.price
                });
            }
            
            updateCart();
            saveCartToStorage();
            
            const button = document.getElementById('detailBuyButton');
            button.innerHTML = '<i class="fas fa-check"></i> Ajout√©';
            button.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
            
            setTimeout(() => {
                button.innerHTML = currentProductDetail.available ? 'Ajouter au panier' : 'Indisponible';
                button.style.background = currentProductDetail.available ? 
                    'linear-gradient(135deg, #4CAF50, #2E7D32)' : 
                    'var(--gray-600)';
            }, 1500);
            
            showAlert(`‚úÖ ${quantity} ${currentProductDetail.name} ajout√©(s) !`);
            closeProductDetail();
        }
        
        function getCategoryLabel(category) {
            const labels = {
                'evenements': 'üéä √âv√©nement',
                'repas': 'üçΩÔ∏è Repas',
                'catering': 'üë®‚Äçüç≥ Catering',
                'alimentation': 'ü•ó Alimentation',
                'boissons': 'ü•§ Boisson',
                'alcools': 'üçæ Alcool',
                'accessoires': 'üîå Accessoire'
            };
            return labels[category] || category;
        }

        // ==================== FONCTIONS PANIER ====================
        function calculateSubtotal() {
            return cart.reduce((total, item) => {
                return total + (item.price * item.quantity);
            }, 0);
        }
        
        function calculateClientDiscount(subtotal) {
            if (!currentClient) return 0;
            
            // Ne pas appliquer la r√©duction sur les √©v√©nements
            const nonEventSubtotal = cart.reduce((total, item) => {
                if (item.category !== 'evenements') {
                    return total + (item.originalPrice || item.price) * item.quantity;
                }
                return total;
            }, 0);
            
            return nonEventSubtotal * (CLIENT_DISCOUNT / 100);
        }
        
        function addToCartWithQuantity(productId, button) {
            const product = products.find(p => p.id === productId);
            if (!product || !product.available) {
                showAlert('‚ùå Produit indisponible', 'error');
                return;
            }
            
            const productElement = button.closest('.product-card');
            const quantity = parseInt(productElement.querySelector('.quantity-input').value);
            let price = product.price;
            
            // Appliquer la r√©duction client si applicable
            if (currentClient && product.category !== 'evenements') {
                price = price * (1 - CLIENT_DISCOUNT / 100);
            }
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
                existingItem.price = price; // Mettre √† jour le prix
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: price,
                    quantity: quantity,
                    category: product.category,
                    originalPrice: product.price
                });
            }
            
            updateCart();
            saveCartToStorage();
            
            button.innerHTML = '<i class="fas fa-check"></i> Ajout√©';
            button.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
            
            setTimeout(() => {
                button.innerHTML = product.available ? 'Ajouter' : 'Indisponible';
                button.style.background = product.available ? 
                    'linear-gradient(135deg, #4CAF50, #2E7D32)' : 
                    'var(--gray-600)';
            }, 1500);
            
            showAlert(`‚úÖ ${quantity} ${product.name} ajout√©(s) !`);
        }
        
        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const subtotalEl = document.getElementById('subtotal');
            const cartTotal = document.getElementById('cartTotal');
            const deliveryCostEl = document.getElementById('deliveryCost');
            const clientDiscountEl = document.getElementById('clientDiscount');
            
            if (!cartItems || !cartCount) return;
            
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--gray-500);">
                        <div style="font-size: 40px; margin-bottom: 10px;">üõí</div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Panier vide</div>
                        <div style="font-size: 13px;">Ajoutez des produits ou un √©v√©nement</div>
                    </div>
                `;
                cartCount.textContent = '0';
                if (subtotalEl) subtotalEl.textContent = '0‚Ç¨';
                if (cartTotal) cartTotal.textContent = 'Total : 0‚Ç¨';
                if (deliveryCostEl) deliveryCostEl.textContent = 'Gratuit';
                if (clientDiscountEl) clientDiscountEl.textContent = '0‚Ç¨';
                return;
            }
            
            let subtotal = 0;
            let itemsHTML = '';
            
            cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                itemsHTML += `
                    <div class="cart-item">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-quantity">${item.quantity}x</div>
                        <div class="cart-item-price">${itemTotal.toFixed(2)}‚Ç¨</div>
                        <button class="cart-item-remove" onclick="removeFromCart(${index})">√ó</button>
                    </div>
                `;
            });
            
            cartItems.innerHTML = itemsHTML;
            
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            const discount = calculateClientDiscount(subtotal);
            const deliveryCost = subtotal >= 200 ? 0 : 5; // Simplifi√© pour l'exemple
            const totalWithEverything = subtotal - discount + deliveryCost;
            
            if (subtotalEl) subtotalEl.textContent = subtotal.toFixed(2) + '‚Ç¨';
            if (clientDiscountEl) {
                clientDiscountEl.textContent = discount > 0 ? `-${discount.toFixed(2)}‚Ç¨` : '0‚Ç¨';
                clientDiscountEl.style.color = discount > 0 ? '#4CAF50' : 'var(--gray-400)';
            }
            if (cartTotal) cartTotal.textContent = `Total : ${totalWithEverything.toFixed(2)}‚Ç¨`;
            if (deliveryCostEl) {
                if (deliveryCost === 0) {
                    deliveryCostEl.textContent = 'Gratuit';
                    deliveryCostEl.style.color = '#4CAF50';
                } else {
                    deliveryCostEl.textContent = deliveryCost + '‚Ç¨';
                    deliveryCostEl.style.color = 'var(--primary-yellow)';
                }
            }
            
            updateFormHiddenFields(subtotal, totalWithEverything, deliveryCost, totalItems, discount);
        }
        
        function updateFormHiddenFields(subtotal, total, deliveryCost, totalItems, discount) {
            const orderDetails = cart.map(item => 
                `${item.quantity}x ${item.name} - ${item.price.toFixed(2)}‚Ç¨ = ${(item.price * item.quantity).toFixed(2)}‚Ç¨`
            ).join('\n');
            
            document.getElementById('orderDetails').value = orderDetails;
            document.getElementById('totalOrderInput').value = total.toFixed(2) + '‚Ç¨';
            document.getElementById('deliveryFeeInput').value = deliveryCost + '‚Ç¨';
            document.getElementById('itemCountInput').value = totalItems;
            document.getElementById('clientDiscountInput').value = discount.toFixed(2) + '‚Ç¨';
        }
        
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCart();
            saveCartToStorage();
            showAlert('üóëÔ∏è Produit retir√©');
        }
        
        function checkout() {
            if (cart.length === 0) {
                showAlert('üõí Panier vide !', 'error');
                return;
            }
            
            closeCart();
            setTimeout(() => {
                document.getElementById('checkoutModalOverlay').classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Afficher le tableau de prix si un √©v√©nement est s√©lectionn√©
                const eventType = document.querySelector('select[name="type_evenement"]').value;
                if (eventType) {
                    document.getElementById('eventPricingTable').style.display = 'block';
                    calculateEventPrice();
                }
            }, 300);
        }
        
        function submitOrder() {
            const confirmationCode = Math.floor(1000 + Math.random() * 9000).toString();
            currentConfirmationCode = confirmationCode;
            document.getElementById('confirmationCodeInput').value = confirmationCode;
            document.getElementById('confirmationCode').textContent = confirmationCode;
            
            const drivers = ['Mohamed (06 12 34 56 78)', 'Karim (06 87 65 43 21)', 'Ahmed (06 98 76 54 32)'];
            const times = ['25-35 minutes', '30-40 minutes', '35-45 minutes'];
            
            document.getElementById('deliveryTimeEstimate').textContent = times[Math.floor(Math.random() * times.length)];
            document.getElementById('deliveryDriver').textContent = drivers[Math.floor(Math.random() * drivers.length)];
            
            closeCheckout();
            setTimeout(() => {
                document.getElementById('confirmationModalOverlay').classList.add('active');
                document.body.style.overflow = 'hidden';
            }, 300);
        }
        
        function validateAndCloseConfirmation() {
            // 1. Calculer les frais r√©els avec l'adresse et type d'√©v√©nement
            const addressInput = document.querySelector('textarea[name="adresse"]');
            const eventTypeSelect = document.querySelector('select[name="type_evenement"]');
            
            const userAddress = addressInput ? addressInput.value : "Marseille";
            const eventType = eventTypeSelect ? eventTypeSelect.value : 'none';
            
            let subtotal = calculateSubtotal();
            const discount = calculateClientDiscount(subtotal);
            const deliveryInfo = calculateRealisticDeliveryFees(subtotal, userAddress, eventType);
            const totalWithDelivery = subtotal - discount + deliveryInfo.cost;
            
            // 2. Mettre √† jour les champs cach√©s avec les vraies infos
            document.getElementById('totalOrderInput').value = totalWithDelivery.toFixed(2) + '‚Ç¨';
            document.getElementById('deliveryFeeInput').value = deliveryInfo.cost + '‚Ç¨';
            document.getElementById('clientDiscountInput').value = discount.toFixed(2) + '‚Ç¨';
            
            // 3. ENVOYER √Ä FORMSPREE
            document.getElementById('checkoutForm').submit();
            
            // 4. G√©n√©rer un code de commande unique
            currentOrderCode = 'HDS' + Math.floor(10000 + Math.random() * 90000);
            
            // 5. Sauvegarder les infos
            localStorage.setItem('hds_shop_order_confirmed', 'true');
            localStorage.setItem('hds_shop_order_code', currentOrderCode);
            localStorage.setItem('hds_shop_confirmation_code', currentConfirmationCode);
            
            // 6. Livreur al√©atoire
            const drivers = [
                {name: 'Mohamed', phone: '06 12 34 56 78'},
                {name: 'Karim', phone: '06 87 65 43 21'},
                {name: 'Ahmed', phone: '06 98 76 54 32'}
            ];
            
            const selectedDriver = drivers[Math.floor(Math.random() * drivers.length)];
            currentDriverName = selectedDriver.name;
            currentDriverPhone = selectedDriver.phone;
            
            // Ajuster le temps de livraison selon la distance et √©v√©nement
            let estimatedTime = '30-40 minutes';
            if (eventType !== 'none') {
                estimatedTime = 'Planifi√© selon date';
            } else if (deliveryInfo.distance > 10) {
                estimatedTime = '45-60 minutes';
            } else if (deliveryInfo.distance > 5) {
                estimatedTime = '35-50 minutes';
            }
            currentDeliveryTime = estimatedTime;
            
            localStorage.setItem('hds_shop_driver_name', currentDriverName);
            localStorage.setItem('hds_shop_driver_phone', currentDriverPhone);
            localStorage.setItem('hds_shop_delivery_time', currentDeliveryTime);
            localStorage.setItem('hds_shop_delivery_distance', deliveryInfo.distance.toFixed(1));
            localStorage.setItem('hds_shop_delivery_zone', deliveryInfo.zone);
            localStorage.setItem('hds_shop_event_type', eventType);
            
            // 7. Ajouter √† l'historique du client
            if (currentClient) {
                addOrderToHistory({
                    code: currentOrderCode,
                    items: cart.reduce((sum, item) => sum + item.quantity, 0),
                    total: totalWithDelivery.toFixed(2) + '‚Ç¨'
                });
            }
            
            // 8. Vider le panier
            cart = [];
            updateCart();
            saveCartToStorage();
            
            // 9. Afficher le bouton de suivi
            document.getElementById('followDeliveryButton').style.display = 'block';
            
            // 10. Mettre √† jour le statut avec info de distance
            document.getElementById('deliveryStatus').textContent = eventType !== 'none' ? '√âv√©nement planifi√©' : 'En route';
            document.getElementById('deliveryStatus').style.background = eventType !== 'none' ? 'rgba(156,39,176,0.2)' : 'rgba(255, 152, 0, 0.2)';
            document.getElementById('deliveryStatus').style.color = eventType !== 'none' ? '#9C27B0' : '#FF9800';
            document.getElementById('deliveryStatus').style.borderColor = eventType !== 'none' ? 'rgba(156,39,176,0.3)' : 'rgba(255, 152, 0, 0.3)';
            
            if (eventType !== 'none') {
                document.getElementById('driverETA').textContent = `üéä √âv√©nement planifi√© ‚Ä¢ ${getEventLabel(eventType)}`;
            } else {
                document.getElementById('driverETA').textContent = `üìç ${deliveryInfo.zone} ‚Ä¢ ETA: ${currentDeliveryTime}`;
            }
            
            // 11. Fermer le modal
            closeConfirmation();
            
            // 12. Afficher notification avec info de frais
            let feeMessage = deliveryInfo.cost === 0 ? 'Livraison gratuite' : `Frais: ${deliveryInfo.cost}‚Ç¨`;
            let discountMessage = discount > 0 ? ` ‚Ä¢ √âconomie: ${discount.toFixed(2)}‚Ç¨` : '';
            let eventMessage = eventType !== 'none' ? ` ‚Ä¢ √âv√©nement: ${getEventLabel(eventType)}` : '';
            showAlert(`‚úÖ Commande confirm√©e ! Code: ${currentConfirmationCode} ‚Ä¢ ${feeMessage}${discountMessage}${eventMessage}`);
        }
        
        function getEventLabel(eventType) {
            const labels = {
                'anniversaire_enfant': 'Anniversaire Enfant',
                'anniversaire_ado': 'Anniversaire Ado',
                'anniversaire_adultes': 'Anniversaire Adultes',
                'soiree_entreprise': 'Soir√©e Entreprise',
                'mariage': 'Mariage',
                'soiree_privee': 'Soir√©e Priv√©e',
                'baby_shower': 'Baby Shower',
                'evenement_pro': '√âv√©nement Pro'
            };
            return labels[eventType] || eventType;
        }

        // ==================== FONCTIONS SUIVI ====================
        function openDeliveryTrackerModal() {
            document.getElementById('modalOrderCode').textContent = currentOrderCode;
            document.getElementById('modalConfirmationCode').textContent = currentConfirmationCode;
            document.getElementById('modalDriverName').textContent = currentDriverName;
            document.getElementById('modalDriverPhone').textContent = currentDriverPhone;
            document.getElementById('modalDeliveryTime').textContent = currentDeliveryTime;
            
            document.getElementById('deliveryTrackerModalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeDeliveryTrackerModal() {
            document.getElementById('deliveryTrackerModalOverlay').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function startRealisticDeliveryTracker() {
            ['modalStep1', 'modalStep2', 'modalStep3', 'modalStep4'].forEach(step => {
                document.getElementById(step).style.background = 'var(--primary-white)';
                document.getElementById(step).style.borderColor = 'var(--gray-400)';
            });
            document.getElementById('modalStep1').style.borderColor = '#4CAF50';
            document.getElementById('modalDeliveryProgress').style.width = '0%';
            
            let progress = 0;
            let currentStep = 0;
            const steps = [
                {progress: 0, status: "En pr√©paration"},
                {progress: 25, status: "Pr√©paration"},
                {progress: 50, status: "En route"},
                {progress: 75, status: "Arriv√©e"},
                {progress: 100, status: "Livr√©"}
            ];
            
            let trackingInterval = setInterval(() => {
                progress += 0.5;
                if (progress > 100) progress = 100;
                
                document.getElementById('modalDeliveryProgress').style.width = progress + '%';
                document.getElementById('modalDeliveryStatus').textContent = steps[currentStep].status;
                
                if (progress >= 25 && currentStep < 1) {
                    currentStep = 1;
                    document.getElementById('modalStep2').style.borderColor = '#4CAF50';
                    document.getElementById('modalStep2').style.background = '#4CAF50';
                    showAlert('üë®‚Äçüç≥ Commande en pr√©paration');
                }
                if (progress >= 50 && currentStep < 2) {
                    currentStep = 2;
                    document.getElementById('modalStep3').style.borderColor = '#4CAF50';
                    document.getElementById('modalStep3').style.background = '#4CAF50';
                    showAlert('üöó Livreur en route !');
                }
                if (progress >= 75 && currentStep < 3) {
                    currentStep = 3;
                    document.getElementById('modalStep4').style.borderColor = '#4CAF50';
                    document.getElementById('modalStep4').style.background = '#4CAF50';
                    showAlert('üìç Presque arriv√© !');
                }
                if (progress >= 100) {
                    clearInterval(trackingInterval);
                    document.getElementById('modalDeliveryStatus').textContent = 'Livr√© !';
                    document.getElementById('modalDeliveryStatus').style.color = '#4CAF50';
                    document.getElementById('followDeliveryButton').style.display = 'none';
                    localStorage.removeItem('hds_shop_order_confirmed');
                    setTimeout(() => showAlert('‚úÖ Livraison effectu√©e !'), 500);
                }
            }, 300);
        }

        // ==================== √âV√âNEMENTS ====================
        function initEventListeners() {
            // √âcouteur pour le type d'√©v√©nement
            document.querySelector('select[name="type_evenement"]').addEventListener('change', updateEventPricing);
            
            document.getElementById('logoImage').addEventListener('click', function() {
                showImage(this.src);
            });
            
            document.getElementById('statusText').addEventListener('click', function() {
                const messages = [
                    'üéâ Organisation √âv√©nements Marseille',
                    '‚≠ê 4.9/5 ‚Ä¢ 500+ √©v√©nements',
                    'üéØ √âv√©nements premium garantis',
                    'üîê Service discret 24h/24',
                    'üè™ Organisation compl√®te',
                    'üì± Suivi en temps r√©el',
                    'üçΩÔ∏è Catering professionnel',
                    'üéä Anniversaires, mariages, soir√©es'
                ];
                const current = this.querySelector('.status-text').textContent;
                let newMessage;
                do {
                    newMessage = messages[Math.floor(Math.random() * messages.length)];
                } while (newMessage === current);
                
                this.querySelector('.status-text').textContent = newMessage;
            });
            
            document.getElementById('openCartButton').addEventListener('click', openCart);
            
            document.getElementById('cartModalOverlay').addEventListener('click', function(e) {
                if (e.target === this) closeCart();
            });
            
            document.getElementById('checkoutModalOverlay').addEventListener('click', function(e) {
                if (e.target === this) closeCheckout();
            });
            
            document.getElementById('confirmationModalOverlay').addEventListener('click', function(e) {
                if (e.target === this) closeConfirmation();
            });
            
            document.getElementById('storiesModalOverlay').addEventListener('click', function(e) {
                if (e.target === this) closeStories();
            });
            
            document.getElementById('productDetailModal').addEventListener('click', function(e) {
                if (e.target === this) closeProductDetail();
            });
            
            document.getElementById('accountModalOverlay').addEventListener('click', function(e) {
                if (e.target === this) closeAccountModal();
            });
            
            document.getElementById('deliveryTrackerModalOverlay').addEventListener('click', function(e) {
                if (e.target === this) closeDeliveryTrackerModal();
            });
            
            window.addEventListener('resize', function() {
                if (deliveryMap) {
                    setTimeout(() => deliveryMap.invalidateSize(), 100);
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeAllModals();
            });
        }
        
        function initFilters() {
            document.querySelectorAll('.category-tab').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.category-tab').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    currentFilter = this.getAttribute('data-category');
                    renderProducts();
                });
            });
        }
        
        function checkActiveOrder() {
            if (localStorage.getItem('hds_shop_order_confirmed') === 'true') {
                document.getElementById('followDeliveryButton').style.display = 'block';
                currentOrderCode = localStorage.getItem('hds_shop_order_code') || 'CMD-' + Math.floor(10000 + Math.random() * 90000);
                currentConfirmationCode = localStorage.getItem('hds_shop_confirmation_code') || 'HDS-' + Math.floor(1000 + Math.random() * 9000);
                currentDriverName = localStorage.getItem('hds_shop_driver_name') || 'Mohamed';
                currentDriverPhone = localStorage.getItem('hds_shop_driver_phone') || '06 ** ** ** **';
                currentDeliveryTime = localStorage.getItem('hds_shop_delivery_time') || '35 minutes';
            }
        }
        
        function checkClientStatus() {
            const savedClient = localStorage.getItem('hds_shop_client');
            if (savedClient) {
                currentClient = JSON.parse(savedClient);
                updateAccountButton(true);
            }
        }

        // ==================== UTILITAIRES ====================
        function openCart() {
            document.getElementById('cartModalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeCart() {
            document.getElementById('cartModalOverlay').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function closeCheckout() {
            document.getElementById('checkoutModalOverlay').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function closeConfirmation() {
            document.getElementById('confirmationModalOverlay').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                modal.classList.remove('active');
            });
            document.body.style.overflow = 'auto';
        }
        
        function incrementQuantity(button) {
            const input = button.parentElement.querySelector('.quantity-input');
            input.value = parseInt(input.value) + 1;
            input.style.transform = 'scale(1.1)';
            setTimeout(() => input.style.transform = 'scale(1)', 150);
        }
        
        function decrementQuantity(button) {
            const input = button.parentElement.querySelector('.quantity-input');
            if (parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
                input.style.transform = 'scale(0.9)';
                setTimeout(() => input.style.transform = 'scale(1)', 150);
            }
        }
        
        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alertModal');
            const messageEl = document.getElementById('alertMessage');
            
            if (!alert || !messageEl) return;
            
            messageEl.textContent = message;
            alert.style.background = type === 'error' ? 
                'linear-gradient(135deg, #FF5252, #FF1744)' : 
                type === 'warning' ?
                'linear-gradient(135deg, #FF9800, #FF5722)' :
                'linear-gradient(135deg, var(--primary-yellow), var(--accent-orange))';
            
            alert.style.display = 'flex';
            
            setTimeout(() => {
                alert.style.animation = 'slideOutUp 0.3s forwards';
                setTimeout(() => {
                    alert.style.display = 'none';
                    alert.style.animation = '';
                }, 300);
            }, 3000);
        }
        
        function showImage(src) {
            const modal = document.getElementById('imageModal');
            const img = document.getElementById('zoomedImage');
            img.src = src;
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeImage() {
            document.getElementById('imageModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function saveCartToStorage() {
            localStorage.setItem('hds_shop_cart', JSON.stringify(cart));
        }
        
        function loadCartFromStorage() {
            const saved = localStorage.getItem('hds_shop_cart');
            if (saved) {
                cart = JSON.parse(saved);
                updateCart();
            }
        }
    </script>
</body>
    </html>
